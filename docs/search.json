[
  {
    "objectID": "1.0-Data_preparation.html",
    "href": "1.0-Data_preparation.html",
    "title": "Raw data cleaning and processing to generate Health Canada diet simulation data",
    "section": "",
    "text": "#### Set-up and Library ####\n# *********************************************************************** #\n#                           Set-up and Library                            #\n# *********************************************************************** #\n\n\n# ********************************************** #\n#                    Library                     #\n# ********************************************** #\n\n## data\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(tidylog)\n\nWarning: package 'tidylog' was built under R version 4.3.2\n\n\n\nAttaching package: 'tidylog'\n\n\nThe following objects are masked from 'package:dplyr':\n\n    add_count, add_tally, anti_join, count, distinct, distinct_all,\n    distinct_at, distinct_if, filter, filter_all, filter_at, filter_if,\n    full_join, group_by, group_by_all, group_by_at, group_by_if,\n    inner_join, left_join, mutate, mutate_all, mutate_at, mutate_if,\n    relocate, rename, rename_all, rename_at, rename_if, rename_with,\n    right_join, sample_frac, sample_n, select, select_all, select_at,\n    select_if, semi_join, slice, slice_head, slice_max, slice_min,\n    slice_sample, slice_tail, summarise, summarise_all, summarise_at,\n    summarise_if, summarize, summarize_all, summarize_at, summarize_if,\n    tally, top_frac, top_n, transmute, transmute_all, transmute_at,\n    transmute_if, ungroup\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nlibrary(readxl)\nlibrary(janitor)\n\n\nAttaching package: 'janitor'\n\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\nlibrary(hefi2019) # Install with &lt;devtools::install_github(\"didierbrassard/hefi2019\")&gt;\n\n## presentation\nlibrary(gt)\n\nWarning: package 'gt' was built under R version 4.3.3\n\n## project\nlibrary(here)\n\nhere() starts at /Users/DidierBrassard/RStudio/NuAge_protocol\n\n## suppress scientific notation\noptions(scipen = 9999)\n\n\n# ********************************************** #\n#                  Directories                   #\n# ********************************************** #\n\n## Local directory\ndir_scripts &lt;- here::here(\"scripts\")\ndir_metadata &lt;- here::here(\"data\", \"metadata\")\ndir_processed &lt;- here::here(\"data\", \"processed\")\ndir_raw &lt;- here::here(\"data\",\"raw\")\ndir_results &lt;- here::here(\"data\", \"results\")\ndir_temp &lt;- here::here(\"data\",\"temp\")\nif(dir.exists(dir_temp)==FALSE){\n  dir.create(dir_temp)\n}\n\n\n# ********************************************** #\n#            Load functions and data             #\n# ********************************************** #\n\nsource(file.path(dir_scripts, \"save_and_summarize_data.R\"))\n\n\n#### Preparing Health Canada diet simulation ####\n# *********************************************************************** #\n#                Preparing Health Canada diet simulation                  #\n# *********************************************************************** #\n\n# Objective:\n# 1) read and format simulation data;\n# 2) output table of dietary constituents and nutrients (1 diet = wide format)\n\n\n##### 1) Download/read data #####\n# ********************************************** #\n#               Download/read data               #\n# ********************************************** #\n\n# Omnivore\n  if(file.exists(file.path(dir_raw,\"HC_simulated_omni.xlsx\"))==FALSE){\n  download.file(\"https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be/resource/94064331-b1b9-41f5-9ba8-1bf77b880053/download/simulated-composite-diets-omnivore.xlsx\",\n                destfile =file.path(dir_raw,\"HC_simulated_omni.xlsx\"))\n  } else {\n    message(\"dir_raw/HC_simulated_omni.xlsx found. Date modified:\", file.info(file.path(dir_raw,\"HC_simulated_omni.xlsx\"))$mtime)\n  }\n\ndir_raw/HC_simulated_omni.xlsx found. Date modified:2024-05-29 14:50:11.318581\n\n# Omnivore, no beverages\n  if(file.exists(file.path(dir_raw,\"HC_simulated_omni_nobev.xlsx\"))==FALSE){\n  download.file(\"https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be/resource/66919cac-5d2d-4617-be01-9faafd539f2f/download/simulated-composite-diets-omnivore-no-healthy-beverages.xlsx\",\n                destfile =file.path(dir_raw,\"HC_simulated_omni_nobev.xlsx\"))\n  } else {\n    message(\"dir_raw/HC_simulated_omni_nobev.xlsx found. Date modified:\", file.info(file.path(dir_raw,\"HC_simulated_omni_nobev.xlsx\"))$mtime)\n  }\n\ndir_raw/HC_simulated_omni_nobev.xlsx found. Date modified:2024-05-29 14:50:11.322398\n\n# Lacto-ovo-vege\n  if(file.exists(file.path(dir_raw,\"HC_simulated_vege.xlsx\"))==FALSE){\n  download.file(\"https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be/resource/3813380e-9978-4d19-995b-c4617ad58019/download/simulated-composite-diets-lacto-ovo-vegetarian.xlsx\",\n                destfile =file.path(dir_raw,\"HC_simulated_vege.xlsx\"))\n  } else {\n    message(\"dir_raw/HC_simulated_vege.xlsx found. Date modified:\", file.info(file.path(dir_raw,\"HC_simulated_vege.xlsx\"))$mtime)\n  }\n\ndir_raw/HC_simulated_vege.xlsx found. Date modified:2024-05-29 14:50:11.325357\n\n\n\n##### 2) Function to read and output data #####\n# ********************************************** #\n#        Function to read and output data        #\n# ********************************************** #\n\nRead Nutrient Data and Output\nThis function reads diet simulation data from an Excel file, performs some cleaning operations, and outputs a list containing serving data, total nutrients, and composite food-specific nutrients.\n@param hc_file Character string, the name of the Excel file. @param dri_group Character string, the sheet name in the Excel file. @param total_rownb Numeric, the total number of rows to read from the table in the dri_group-specific sheet\n@return A list containing serving data, total nutrients, and composite food-specific nutrients.\n@examples \n@import readxl @import janitor @import stringr @import dplyr\n@export\n\nread_n_output &lt;- function(hc_file, dri_group, total_rownb = 20) {\n  \n  message(paste0(\"Reading: \",hc_file, \"; sheet: \", dri_group))\n  # Helper function for reading Excel data\n  read_excel_data &lt;- function(range) {\n    readxl::read_excel(\n      file.path(dir_raw, hc_file),\n      sheet = dri_group,\n      range = range\n    )\n  }\n  cat(\"Composite food serving ...\\n\")\n  # Composite servings\n  serving &lt;- read_excel_data(paste0(\"A3:C\", total_rownb-1)) |&gt;\n    janitor::clean_names() |&gt;\n    select(-x3) |&gt;\n    setNames(c(\"NB_RA\", \"COMPOSITE\")) |&gt;\n    mutate(COMPOSITE = stringr::str_squish(COMPOSITE)) |&gt;\n    select(COMPOSITE, NB_RA)\n  \n  # Total nutrients\n  cat(\"Total nutrient ...\\n\")\n  varnames_nut &lt;- read_excel_data(\"E2:AJ3\") |&gt; names()\n  total_nut &lt;- read_excel_data(paste0(\"E3:AJ\", total_rownb)) |&gt;\n    janitor::clean_names() |&gt;\n    setNames(varnames_nut) \n  \n  # Composite food-specific nutrients\n  cat(\"Composite food-specific nutrients ...\\n\")\n  composite_nut &lt;- read_excel_data(paste0(\"A3:AJ\", total_rownb-1)) |&gt;\n    janitor::clean_names() |&gt;\n    janitor::remove_empty(which = \"cols\") |&gt;\n    setNames(c(\"NB_RA\", \"COMPOSITE\", varnames_nut)) |&gt;\n    mutate(COMPOSITE = stringr::str_squish(COMPOSITE))\n  \n  return(list(serving, total_nut, composite_nut))  \n}\n\n\n##### 3) Apply function to each DRI group #####\n# ********************************************** #\n#        Apply function to each DRI group        #\n# ********************************************** #\n\n# note: using omnivore diets with beverage as most likely reflect majority of Canadians\n\nhc_file &lt;- \"HC_simulated_omni.xlsx\"\n\ndrig12 &lt;- \n  read_n_output(\n    hc_file  ,\n    dri_group   = \"M 51-70\",\n    total_rownb = 19\n  )\n\nReading: HC_simulated_omni.xlsx; sheet: M 51-70\n\n\nComposite food serving ...\n\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n\n\nselect: dropped one variable (x3)\nmutate: no changes\nselect: columns reordered (COMPOSITE, NB_RA)\n\n\nTotal nutrient ...\n\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n\n\nComposite food-specific nutrients ...\n\n\nNew names:\nmutate: no changes\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n• `` -&gt; `...33`\n• `` -&gt; `...34`\n• `` -&gt; `...35`\n• `` -&gt; `...36`\n\ndrig14 &lt;- \n  read_n_output(\n    hc_file  ,\n    dri_group   = \"M 70 +\",\n    total_rownb = 22\n  )\n\nReading: HC_simulated_omni.xlsx; sheet: M 70 +\n\n\nComposite food serving ...\n\n\nNew names:\nselect: dropped one variable (x3)\nmutate: no changes\nselect: columns reordered (COMPOSITE, NB_RA)\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n\n\nTotal nutrient ...\n\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n\n\nComposite food-specific nutrients ...\n\n\nNew names:\nmutate: no changes\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n• `` -&gt; `...33`\n• `` -&gt; `...34`\n• `` -&gt; `...35`\n• `` -&gt; `...36`\n\ndrig13 &lt;- \n  read_n_output(\n    hc_file  ,\n    dri_group   = \"F 51-70\",\n    total_rownb = 20\n  )\n\nReading: HC_simulated_omni.xlsx; sheet: F 51-70\n\n\nComposite food serving ...\n\n\nNew names:\nselect: dropped one variable (x3)\nmutate: no changes\nselect: columns reordered (COMPOSITE, NB_RA)\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n\n\nTotal nutrient ...\n\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n\n\nComposite food-specific nutrients ...\n\n\nNew names:\nmutate: no changes\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n• `` -&gt; `...33`\n• `` -&gt; `...34`\n• `` -&gt; `...35`\n• `` -&gt; `...36`\n\ndrig15 &lt;- \n  read_n_output(\n    hc_file ,\n    dri_group   = \"F 70 +\",\n    total_rownb = 20\n  )\n\nReading: HC_simulated_omni.xlsx; sheet: F 70 +\n\n\nComposite food serving ...\n\n\nNew names:\nselect: dropped one variable (x3)\nmutate: no changes\nselect: columns reordered (COMPOSITE, NB_RA)\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n\n\nTotal nutrient ...\n\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n\n\nComposite food-specific nutrients ...\n\n\nNew names:\nmutate: no changes\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n• `` -&gt; `...25`\n• `` -&gt; `...26`\n• `` -&gt; `...27`\n• `` -&gt; `...28`\n• `` -&gt; `...29`\n• `` -&gt; `...30`\n• `` -&gt; `...31`\n• `` -&gt; `...32`\n• `` -&gt; `...33`\n• `` -&gt; `...34`\n• `` -&gt; `...35`\n• `` -&gt; `...36`\n\n\n\n##### 4) Calculate total intakes for each DRI group #####\n# ********************************************** #\n#   Calculate total intakes for each DRI group   #\n# ********************************************** #\n\nCalculate DRI group Nutrients\nThis function calculates nutrient summary for a specific DRI group.\n@param drig A list containing DRI group data. @param drig_suffix Numeric, the DRI group suffix (e.g., 12). @param nut_list Character, vector of nutrients (i.e., variable names) for which totals should be calculated\n@return A data frame containing the calculated nutrient summary for the specified DRI group.\n@examples \n@import dplyr\n@export\n\ncalculate_drig_nutrients &lt;- function(drig, drig_suffix, nut_list = c(\"EKC\",\"FSUG\",\"FAS\",\"FAM\",\"FAP\",\"SOD\",\"PRO\")) {\n  \n  # Output detailed summary to calculate fat intake (missing)\n  all_but_total &lt;- drig[[2]][1:nrow(drig[[2]])-1,]\n  \n  drig_nut &lt;-\n    drig[[2]] |&gt;\n    select(all_of(nut_list)) |&gt;\n    slice_tail() |&gt;\n    mutate(\n      # add missing nutrients\n      FAM = sum(all_but_total$FAM, na.rm = TRUE),\n      FAP = sum(all_but_total$FAP, na.rm = TRUE),\n      # add drig id\n      drig = drig_suffix\n    )\n  \n    return(drig_nut)\n}\n\n# ************************** #\n#   Apply function on list   #\n# ************************** #\n\ndrig_all &lt;- list(drig12, drig14, drig13, drig15)\ndrig_suffix_all &lt;- c(12, 14, 13, 15)\n\ndrig_nut_all &lt;- \n  Map(calculate_drig_nutrients, drig_all, drig_suffix_all) |&gt;\n  purrr::reduce(rbind)\n\nselect: dropped 25 variables (CAR, FI, SUG, FAT, FAL, …)\nslice_tail: removed 15 rows (94%), one row remaining\nmutate: changed one value (100%) of 'FAM' (one fewer NA)\n        changed one value (100%) of 'FAP' (one fewer NA)\n        new variable 'drig' (double) with one unique value and 0% NA\nselect: dropped 25 variables (CAR, FI, SUG, FAT, FAL, …)\nslice_tail: removed 18 rows (95%), one row remaining\nmutate: changed one value (100%) of 'FAM' (one fewer NA)\n        changed one value (100%) of 'FAP' (one fewer NA)\n        new variable 'drig' (double) with one unique value and 0% NA\nselect: dropped 25 variables (CAR, FI, SUG, FAT, FAL, …)\nslice_tail: removed 16 rows (94%), one row remaining\nmutate: new variable 'drig' (double) with one unique value and 0% NA\nselect: dropped 25 variables (CAR, FI, SUG, FAT, FAL, …)\nslice_tail: removed 16 rows (94%), one row remaining\nmutate: changed one value (100%) of 'FAM' (one fewer NA)\n        changed one value (100%) of 'FAP' (one fewer NA)\n        new variable 'drig' (double) with one unique value and 0% NA\n\n# ************************** #\n#   Males, 51-70: drig=12    #\n# ************************** #\n\ndrig12_ra &lt;- \n  drig12[[1]] |&gt;\n  mutate(drig=12)\n\nmutate: new variable 'drig' (double) with one unique value and 0% NA\n\n# ************************** #\n#    Males, 71 +: drig=14    #\n# ************************** #\n\ndrig14_ra &lt;- \n  drig14[[1]] |&gt;\n  mutate(drig=14)\n\nmutate: new variable 'drig' (double) with one unique value and 0% NA\n\n# ************************** #\n#  Females, 51-70: drig=13   #\n# ************************** #\n\ndrig13_ra &lt;- \n  drig13[[1]] |&gt;\n  mutate(drig=13)\n\nmutate: new variable 'drig' (double) with one unique value and 0% NA\n\n# ************************** #\n#    Males, 71 +: drig=15    #\n# ************************** #\n\ndrig15_ra &lt;- \n  drig15[[1]] |&gt;\n  mutate(drig=15)\n\nmutate: new variable 'drig' (double) with one unique value and 0% NA\n\n\n\n##### 5) Append data together #####\n# ********************************************** #\n#              Append data together              #\n# ********************************************** #\n\ndietsim_bydrig &lt;-\n  rbind(\n    drig12_ra , drig14_ra , drig13_ra , drig15_ra) |&gt;\n  mutate(\n    # Add HEFI-2019 classification\n    hefi2019subgrp =\n      case_when(\n        grepl(\"TOTAL VEGETABLES\",COMPOSITE)&gt;0 ~ \"vf\",\n        grepl(\"TOTAL WHOLE\",COMPOSITE)&gt;0 ~ \"wg\",\n        grepl(\"ANIMAL-BASED\",COMPOSITE)&gt;0 ~ \"pfab\",\n        grepl(\"PLANT-BASED\",COMPOSITE)&gt;0 ~ \"pfpb\",\n        grepl(\"HEALTHY BEVERAGES\",COMPOSITE)&gt;0 ~ \"milk_plantbev\",\n        grepl(\"UNSATURATED OILS\",COMPOSITE)&gt;0 ~ \"ufa\"\n      ) # end of case_when\n  ) |&gt; # end of mutate\n  # remove non-hefi food groups (i.e., subclassification)\n  filter(is.na(hefi2019subgrp)==FALSE) |&gt;\n  # Transpose long data to wide\n  select(-COMPOSITE) |&gt;\n  pivot_wider(\n    names_from  = \"hefi2019subgrp\",\n    values_from = \"NB_RA\"\n  ) |&gt;\n  # add hefi-2019 nutrients\n  full_join(\n    drig_nut_all,\n    by = \"drig\"\n  ) |&gt;\n  # ensure variable names are not capital letters\n  janitor::clean_names()\n\nmutate: new variable 'hefi2019subgrp' (character) with 7 unique values and 63% NA\nfilter: removed 41 rows (63%), 24 rows remaining\nselect: dropped one variable (COMPOSITE)\npivot_wider: reorganized (NB_RA, hefi2019subgrp) into (vf, wg, pfpb, pfab, milk_plantbev, …) [was 24x3, now 4x7]\nfull_join: added 7 columns (EKC, FSUG, FAS, FAM, FAP, …)\n           &gt; rows only in pivot_wider(select(filt..  0\n           &gt; rows only in drig_nut_all               0\n           &gt; matched rows                            4\n           &gt;                                        ===\n           &gt; rows total                              4\n\n# Generate an 'overall' row\ndietsim_drig0 &lt;- \n  dietsim_bydrig |&gt;\n  # calculate mean\n  summarise(\n    across(.cols=all_of(names(dietsim_bydrig[-1])),\n           function(x) mean(x),\n           .names =\"{col}\" )\n  ) |&gt;\n  mutate(\n    drig=0\n  )\n\nsummarise: now one row and 13 columns, ungrouped\nmutate: new variable 'drig' (double) with one unique value and 0% NA\n\ndim(dietsim_drig0); head(dietsim_drig0)\n\n[1]  1 14\n\n\n# A tibble: 1 × 14\n     vf    wg  pfpb  pfab milk_plantbev   ufa   ekc  fsug   fas   fam   fap\n  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1  9.03  3.92  2.04  1.88             1     1 1865.  6.37  10.2  21.5  20.1\n# ℹ 3 more variables: sod &lt;dbl&gt;, pro &lt;dbl&gt;, drig &lt;dbl&gt;\n\n# Add 'overall' row to drig-specific rows\ndietsim &lt;- \n  rbind(dietsim_bydrig, dietsim_drig0) |&gt;\n  arrange(drig) |&gt;\n  mutate(\n    drig_f = \n      factor(drig,\n             levels = c(0, 12, 13, 14, 15),\n             labels = c(\"Male and female, 51 y or older\",\n                        \"Male, 51-70 y\",\n                        \"Female, 51-70 y\",\n                        \"Male, 71y+\",\n                        \"Female, 71y+\"))\n  )\n\nmutate: new variable 'drig_f' (factor) with 5 unique values and 0% NA\n\ndim(dietsim); names(dietsim); head(dietsim)\n\n[1]  5 15\n\n\n [1] \"drig\"          \"vf\"            \"wg\"            \"pfpb\"         \n [5] \"pfab\"          \"milk_plantbev\" \"ufa\"           \"ekc\"          \n [9] \"fsug\"          \"fas\"           \"fam\"           \"fap\"          \n[13] \"sod\"           \"pro\"           \"drig_f\"       \n\n\n# A tibble: 5 × 15\n   drig    vf    wg  pfpb  pfab milk_plantbev   ufa   ekc  fsug   fas   fam\n  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n1     0  9.03  3.92  2.04  1.88             1     1 1865.  6.37 10.2   21.5\n2    12  9.93  5     2.42  2.29             1     1 2259.  7.10 11.7   24.4\n3    13  8.56  3.5   2     1.85             1     1 1737.  5.52  9.74  20.8\n4    14  9.93  4.2   2     1.84             1     1 1959.  6.98 10.6   22.3\n5    15  7.71  3     1.72  1.56             1     1 1507.  5.87  8.71  18.5\n# ℹ 4 more variables: fap &lt;dbl&gt;, sod &lt;dbl&gt;, pro &lt;dbl&gt;, drig_f &lt;fct&gt;\n\n# ************************** #\n#         Add labels         #\n# ************************** #\n\nlabelled::var_label(dietsim) &lt;-\nlist(\n  drig          = \"DRI age and sex group\",\n  drig_f        = \"DRI age and sex group\",\n  vf            = \"Vegetables and fruits, RA/d\",\n  wg            = \"Whole-grain foods, RA/d\",\n  pfpb          = \"Protein foods, plant-based, RA/d\",\n  pfab          = \"Protein foods, animal-based, RA/d\",\n  milk_plantbev = \"Unsweetened milk and plant beverage with protein, RA/d\",\n  ufa           = \"Unsaturated fats, RA/d\",\n  ekc           = \"Total energy intake, kcal/d\",\n  fsug          = \"Free sugars, grams/d\",\n  fas           = \"Saturated fats, grams/d\",\n  fam           = \"Monounsaturated fats, grams/d\",\n  fap           = \"Polyunsaturated fats, grams/d\",\n  sod           = \"Sodium, mg/d\",\n  pro           = \"Protein, grams/d\")\n\n\n#### Calculate HEFI-2019 scores ####\n# ********************************************** #\n#           Calculate HEFI-2019 scores           #\n# ********************************************** #\n\n# Apply the hefi-2019 scoring algorithm\n \ndietsim_hefi &lt;-\n  dietsim |&gt;\n  mutate(\n    # Change milk_plantbev RA to grams\n    milk_plantbev = milk_plantbev*258,\n    # Without further information for milk_plantbev = split half/half\n    milk = milk_plantbev/2,\n    plantbev = milk_plantbev/2\n  ) |&gt;\n  hefi2019::hefi2019(#indata      = dietsim,\n    vegfruits          = vf,\n    wholegrfoods       = wg,\n    nonwholegrfoods    = 0,\n    profoodsanimal     = pfab,\n    profoodsplant      = pfpb,\n    otherfoods         = 0,\n    waterhealthybev    = 0,\n    unsweetmilk        = milk,\n    unsweetplantbevpro = plantbev,\n    otherbeverages     = 0 ,\n    mufat              = fam ,\n    pufat              = fap ,\n    satfat             = fas ,\n    freesugars         = fsug,\n    sodium             = sod,\n    energy             = ekc\n  )\n\nHealthy Eating Food Index-2019 Scoring Algorithm R version 1.4\n\n\nmutate: changed 5 values (100%) of 'milk_plantbev' (0 new NAs)\n        new variable 'milk' (double) with one unique value and 0% NA\n        new variable 'plantbev' (double) with one unique value and 0% NA\n\n# ************************** #\n#         Add labels         #\n# ************************** #\n\nlabelled::var_label(dietsim_hefi) &lt;-\n  list(\n    drig          = \"DRI age and sex group\",\n    drig_f        = \"DRI age and sex group\",\n    vf            = \"Vegetables and fruits, RA/d\",\n    wg            = \"Whole-grain foods, RA/d\",\n    pfpb          = \"Protein foods, plant-based, RA/d\",\n    pfab          = \"Protein foods, animal-based, RA/d\",\n    milk_plantbev = \"Unsweetened milk and plant beverage with protein, RA/d\",\n    ufa           = \"Unsaturated fats, RA/d\",\n    ekc           = \"Total energy intake, kcal/d\",\n    fsug          = \"Free sugars, grams/d\",\n    fas           = \"Saturated fats, grams/d\",\n    fam           = \"Monounsaturated fats, grams/d\",\n    fap           = \"Polyunsaturated fats, grams/d\",\n    sod           = \"Sodium, mg/d\",\n    pro           = \"Protein, grams/d\")\n\n\n#### Summary and save ####\n# ********************************************** #\n#                Summary and save                #\n# ********************************************** #\n\n# summary\ndietsim |&gt;\n  select(-c(\"drig\", \"ekc\":\"pro\")) |&gt;\n  gt::gt() |&gt;\n  gt::cols_move_to_start(\"drig_f\") |&gt;\n  gt::fmt_number(columns = everything(), decimals = 1) |&gt;\n  gt::tab_header(\"Intakes of major food categories in Health Canada simulated diets, by DRI group\") |&gt;\n  gt::tab_source_note(source_note = \"Data from Health Canada. (2022). Simulated composite diets. Available at https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be\")\n\nselect: dropped 8 variables (drig, ekc, fsug, fas, fam, …)\n\n\n\n\n\n\n\n\nIntakes of major food categories in Health Canada simulated diets, by DRI group\n\n\nDRI age and sex group\nVegetables and fruits, RA/d\nWhole-grain foods, RA/d\nProtein foods, plant-based, RA/d\nProtein foods, animal-based, RA/d\nUnsweetened milk and plant beverage with protein, RA/d\nUnsaturated fats, RA/d\n\n\n\n\nMale and female, 51 y or older\n9.0\n3.9\n2.0\n1.9\n1.0\n1.0\n\n\nMale, 51-70 y\n9.9\n5.0\n2.4\n2.3\n1.0\n1.0\n\n\nFemale, 51-70 y\n8.6\n3.5\n2.0\n1.9\n1.0\n1.0\n\n\nMale, 71y+\n9.9\n4.2\n2.0\n1.8\n1.0\n1.0\n\n\nFemale, 71y+\n7.7\n3.0\n1.7\n1.6\n1.0\n1.0\n\n\n\nData from Health Canada. (2022). Simulated composite diets. Available at https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be\n\n\n\n\n\n\n\ndietsim |&gt;\n  select(\"drig_f\", \"ekc\":\"pro\") |&gt;\n  gt::gt() |&gt;\n  gt::cols_move_to_start(\"drig_f\") |&gt;\n  gt::fmt_number(columns = everything(), decimals = 1) |&gt;\n  gt::tab_header(\"Intakes of major nutrients in Health Canada simulated diets, by DRI group\") |&gt;\n  gt::tab_source_note(source_note = \"Data from Health Canada. (2022). Simulated composite diets. Available at https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be\")\n\nselect: dropped 7 variables (drig, vf, wg, pfpb, pfab, …)\n\n\n\n\n\n\n\n\nIntakes of major nutrients in Health Canada simulated diets, by DRI group\n\n\nDRI age and sex group\nTotal energy intake, kcal/d\nFree sugars, grams/d\nSaturated fats, grams/d\nMonounsaturated fats, grams/d\nPolyunsaturated fats, grams/d\nSodium, mg/d\nProtein, grams/d\n\n\n\n\nMale and female, 51 y or older\n1,865.3\n6.4\n10.2\n21.5\n20.1\n1,065.8\n97.6\n\n\nMale, 51-70 y\n2,258.8\n7.1\n11.7\n24.4\n20.8\n1,174.3\n118.7\n\n\nFemale, 51-70 y\n1,736.7\n5.5\n9.7\n20.8\n20.5\n992.5\n91.7\n\n\nMale, 71y+\n1,958.7\n7.0\n10.6\n22.3\n20.7\n1,141.7\n102.1\n\n\nFemale, 71y+\n1,507.0\n5.9\n8.7\n18.5\n18.4\n954.5\n77.9\n\n\n\nData from Health Canada. (2022). Simulated composite diets. Available at https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be\n\n\n\n\n\n\n\ndietsim_hefi |&gt;\n  select(starts_with(\"HEFI2019\")) |&gt;\n  gt::gt() |&gt;\n  gt::fmt_number(columns = everything(), decimals = 1) |&gt;\n  gt::tab_header(\"HEFI-2019 scores of Health Canada simulated diets, by DRI group\") |&gt;\n  gt::tab_source_note(source_note = \"Based on data from Health Canada. (2022). Simulated composite diets. Available at https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be\")\n\nselect: dropped 28 variables (drig, vf, wg, pfpb, pfab, …)\n\n\n\n\n\n\n\n\nHEFI-2019 scores of Health Canada simulated diets, by DRI group\n\n\nHEFI2019 C1 Vegetables and fruits\nHEFI2019 C2 Whole-grain foods\nHEFI2019 C3 Grain foods ratio\nHEFI2019 C4 Protein foods\nHEFI2019 C5 Plant-based protein foods\nHEFI2019 C6 Beverages\nHEFI2019 C7 Fatty acids ratio\nHEFI2019 C8 Saturated fats\nHEFI2019 C9 Free sugars\nHEFI2019 C10 Sodium\nTotal Healthy Eating Food Index (/80)\n\n\n\n\n20.0\n4.4\n5.0\n5.0\n4.1\n10.0\n5.0\n5.0\n10.0\n10.0\n78.5\n\n\n19.2\n4.8\n5.0\n5.0\n4.2\n10.0\n5.0\n5.0\n10.0\n10.0\n78.3\n\n\n20.0\n4.1\n5.0\n5.0\n4.1\n10.0\n5.0\n5.0\n10.0\n10.0\n78.3\n\n\n20.0\n4.4\n5.0\n5.0\n4.1\n10.0\n5.0\n5.0\n10.0\n10.0\n78.6\n\n\n20.0\n4.0\n5.0\n5.0\n4.0\n10.0\n5.0\n5.0\n10.0\n10.0\n78.0\n\n\n\nBased on data from Health Canada. (2022). Simulated composite diets. Available at https://open.canada.ca/data/dataset/0490749d-b0b0-410a-9577-a903c6cec2be\n\n\n\n\n\n\n\n# save intake only\nsave_and_summarize_data(\n  dietsim,\n  dir = dir_processed,\n  dir_metadata = dir_metadata\n)\n\nWarning in fun(libname, pkgname): couldn't connect to display\n\"/private/tmp/com.apple.launchd.6tu9LhZbap/org.xquartz:0\"\n\n\nsystem might not have X11 capabilities; in case of errors when using dfSummary(), set st_options(use.x11 = FALSE)\nOutput file written: /Users/DidierBrassard/RStudio/NuAge_protocol/data/metadata/dietsim.html\n\n# save intake + hefi\nsave_and_summarize_data(\n  dietsim_hefi,\n  dir = dir_processed,\n  dir_metadata = dir_metadata\n)\n\nOutput file written: /Users/DidierBrassard/RStudio/NuAge_protocol/data/metadata/dietsim_hefi.html\n\n# *********************************************************************** #\n#                              End of code                                #\n# *********************************************************************** #\n\nsessionInfo()\n\nR version 4.3.1 (2023-06-16)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Sonoma 14.7.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Toronto\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] summarytools_1.0.1 here_1.0.1         gt_0.11.1          hefi2019_0.0.1.4  \n[5] janitor_2.2.0      readxl_1.4.3       tidylog_1.1.0      dplyr_1.1.4       \n\nloaded via a namespace (and not attached):\n [1] sass_0.4.9        utf8_1.2.4        generics_0.1.3    tidyr_1.3.1      \n [5] tcltk_4.3.1       xml2_1.3.6        stringi_1.8.4     rematch_2.0.0    \n [9] hms_1.1.3         digest_0.6.37     magrittr_2.0.3    evaluate_1.0.1   \n[13] timechange_0.3.0  fastmap_1.2.0     plyr_1.8.9        cellranger_1.1.0 \n[17] rprojroot_2.0.4   jsonlite_1.8.9    rapportools_1.1   backports_1.5.0  \n[21] pander_0.6.5      purrr_1.0.2       fansi_1.0.6       codetools_0.2-20 \n[25] cli_3.6.3         labelled_2.13.0   rlang_1.1.4       base64enc_0.1-3  \n[29] withr_3.0.2       yaml_2.3.10       tools_4.3.1       reshape2_1.4.4   \n[33] pryr_0.1.6        checkmate_2.3.2   forcats_1.0.0     vctrs_0.6.5      \n[37] R6_2.5.1          matrixStats_1.4.1 magick_2.8.5      lifecycle_1.0.4  \n[41] lubridate_1.9.3   snakecase_0.11.1  stringr_1.5.1     htmlwidgets_1.6.4\n[45] MASS_7.3-60.0.1   clisymbols_1.2.0  pkgconfig_2.0.3   pillar_1.9.0     \n[49] Rcpp_1.0.13-1     glue_1.8.0        haven_2.5.4       xfun_0.49        \n[53] tibble_3.2.1      tidyselect_1.2.1  rstudioapi_0.17.1 knitr_1.49       \n[57] htmltools_0.5.8.1 rmarkdown_2.29    compiler_4.3.1"
  },
  {
    "objectID": "9.1-Manuscript.html",
    "href": "9.1-Manuscript.html",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "",
    "text": "Code\nprint_table &lt;- \"Y\"\n\n# ********************************************** #\n#                 Quarto set-up                  #\n# ********************************************** #\n\nknitr::opts_chunk$set(dpi = 300,\n                      out.width = \"80%\",\n                      fig.env = \"figure\",\n                      fig.align = \"center\"\n                      )\n\n## suppress scientific notation\noptions(scipen = 9999)\n\n# *********************************************** #\n#                   Packages                      #\n# *********************************************** #\n\n## data\nlibrary(dplyr)\nlibrary(tidylog)\nlibrary(readxl)\n\n## analysis\nlibrary(hefi2019)\n\n## results presentation\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(gt)\nlibrary(tinytex)\nlibrary(MetBrewer)\nlibrary(dagitty)\nlibrary(ggdag)\n\n# ********************************************** #\n#               Location of files                #\n# ********************************************** #\n\ndir_scripts &lt;- here::here(\"scripts\")\ndir_processed &lt;- here::here(\"data\", \"processed\")\ndir_results &lt;- here::here(\"data\", \"results\")\ndir_tab &lt;- here::here(\"manuscript\", \"tables\")\n  if(dir.exists(dir_tab)==FALSE){\n    dir.create(dir_tab, recursive = TRUE)\n  }\ndir_fig &lt;- here::here(\"manuscript\", \"figures\")\n  if(dir.exists(dir_fig)==FALSE){\n    dir.create(dir_fig, recursive = TRUE)\n  }\ndir_supp &lt;- here::here(\"manuscript\", \"supplementary\")\n  if(dir.exists(dir_supp)==FALSE){\n    dir.create(dir_supp, recursive = TRUE)\n  }\n\n# ********************************************** #\n#            Load functions and data             #\n# ********************************************** #\n\nload(file.path(dir_processed, \"dietsim_hefi.rdata\"))\n\n\n## GT Table style\n  gtstyle &lt;- function(gtobject,footnote_marker=\"numbers\"){\n    gtobject |&gt;\n      gt::tab_style(\n        style = list(\n          cell_text(weight = \"bold\")  ),\n        locations = cells_row_groups(groups = everything())\n      ) |&gt;\n      gt::opt_align_table_header(\"left\") |&gt;\n      gt::opt_footnote_marks(marks=footnote_marker)\n  }"
  },
  {
    "objectID": "9.1-Manuscript.html#research-question-and-hypothesis",
    "href": "9.1-Manuscript.html#research-question-and-hypothesis",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Research Question and Hypothesis",
    "text": "Research Question and Hypothesis\nExplicitly acknowledging the causal nature of a research question is prerequisite to causal effect estimation using observational data [26–28]. The general objective of this study will be to examine the adequacy of CFG’s universal dietary recommendations for older adults. Expressed as a counterfactual statement, our objective is to answer the following question:\n\nWhat would be the difference in a given health outcome at the end of the follow-up, if all eligible participants had increased their adherence to CFG recommendations on healthy food choices compared with, instead, if they had maintained their habitual diet?\n\nSpecifically, among adults aged 67 to 84 years followed over 3 years, and compared with maintenance of habits, we aim to:\n\nEstimate the causal effect of adhering to CFG’s dietary recommendations on markers of muscle health (e.g., physical function, muscle strength), general health (e.g., waist circumference, blood pressure, glucose), and cognitive health (i.e., Modified Mini-Mental State Exam) .\n\nHypothesis: adhering to recommendations positively influence general and cognitive health but has no influence on muscle health.\n\nEstimate the causal effect of adhering to a reformulation of CFG’s dietary recommendations, including more protein foods and a minimal physical activity recommendation, to amplify the positive health effects.\n\nHypothesis: increasing the consumption of protein-rich foods positively influence muscle health, and meeting minimal physical activity recommendation (30 minutes or more per day) further amplifies positive health effects."
  },
  {
    "objectID": "9.1-Manuscript.html#study-design-and-sample",
    "href": "9.1-Manuscript.html#study-design-and-sample",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Study Design and Sample",
    "text": "Study Design and Sample\nData from the NuAge prospective cohort study will be used to emulate the target trial [25]. The NuAge cohort comprised 1753 generally healthy community-dwelling adults aged 67 to 84 years at baseline and followed over 3 years. The baseline and each annual follow-up included comprehensive assessment on sociodemographic data, diet, physical activity, functional status as well as physical and mental health [25].\nThe NuAge study sample is relevant to our research question. The target population of CFG recommendations comprise all individuals aged 2 years or older, which is compatible with the target sample of the NuAge study of generally healthy older adults from the greater Montreal, Sherbrooke and Laval areas, the province of Quebec, Canada."
  },
  {
    "objectID": "9.1-Manuscript.html#target-trial",
    "href": "9.1-Manuscript.html#target-trial",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Target trial",
    "text": "Target trial\nThe target trial framework has been suggested as a potential solution to improve the analysis of nutritional epidemiology studies aiming at causal inference [13]. Informally, the target trial framework helps to align the observational data analysis with that of a hypothetical trial. This framework is appropriate for the research question in the present study, since we aim to estimate the effect of adhering to a hypothetical diet and physical activity intervention using on observational data. The first step of a target trial emulation is the description of the target trial, i.e., the protocol of the hypothetical randomized controlled trial we would like to conduct [11,14]. The second step is the emulation, i.e., describing how to target trial is emulated and conducting the study described in the present protocol.\nTable 1 presents the target trial and its emulation using observational data from the NuAge study. Key differences between the target trial and its emulation are that participants will be required to provide complete dietary assessment and covariate data at baseline (eligibility component); and that we will attempt to emulate the randomized assignment by adjusting for dietary intakes before baseline as well as baseline covariates (assignment component).\n\n\nCode\n# #| label: tbl-target\n# #| tbl-cap: \"Target trial\"\n\n# *********************************************************************** #\n#               Generate table presenting the target trial                #\n# *********************************************************************** #\n\ntab_targettrial &lt;- \n  readxl::read_excel(file.path(dir_results,\"Table_data.xlsx\"),\n                   sheet = \"targettrial\") |&gt;\n  gt::gt() |&gt;\n  gt::cols_label(\n    component = \"Trial component\",\n    target  = \"Target trial specification\",\n    emulation = \"Target trial emulation\"\n  ) |&gt;\n  gt::tab_style(\n      style = cell_text(weight = \"bold\"),\n      locations = cells_body(columns=1)\n    ) |&gt;\n  gt::tab_style(\n    style = list(\n      cell_text(weight = \"bold\")  ),\n    locations = cells_column_labels(columns=everything())\n  ) |&gt;\n  gt::tab_header(\n     title = \"Emulation of a dietary intervention target trial\n     using observational data from the NuAge study\") |&gt;\n  gt::tab_footnote(\n    footnote = \"FFQ, food-frequency questionnaire; NuAge, Quebec Longitudinal Study on Nutrition and Successful Aging\",\n    locations = cells_title(\"title\")\n    ) |&gt;\n  gt::tab_footnote(\n    footnote = \"See 'Dietary Strategies' for detailed intervention.\",\n    locations = cells_body(columns=\"component\",rows=2)\n  ) |&gt;\n  gt::tab_footnote(\n    footnote = \"The observational analog of the intention-to-treat contrast corresponds to the baseline values of the intervention, which are both 'assigned' and initiated at the same time.\",\n    locations = cells_body(columns=\"component\", rows=6)\n  )\n\n# ********************************************** #\n#                  Print table                   #\n# ********************************************** #\n\nif(print_table==\"Y\") {\ntab_targettrial |&gt;\n  gtstyle()\n}\n\n\n\n\n\n\n\n\nEmulation of a dietary intervention target trial using observational data from the NuAge study1\n\n\nTrial component\nTarget trial specification\nTarget trial emulation\n\n\n\n\nEligibility criteria\nNuAge inclusion criteria: individuals aged 67-84 y; living in Montreal, Laval or Sherbrooke; not cognitively impaired, free of disabilities in activities of daily living. Exclusion criteria: class II heart failure, chronic obstructive pulmonary disease requiring home oxygen therapy or oral steroids, inflammatory digestive diseases, and cancer treatment in the past 5 years.\nSame. Participants will also be required to have complete baseline dietary assessment (at least one 24-hour recall with 500 kcal or more and FFQ) and baseline covariate data\n\n\nIntervention2\nEach individual would be assigned to 1 of the 4 following strategies: 1) control group (habitual diet, i.e., typical North American); 2) adherence to Canada's Food Guide recommendations on healthy food choices; 3) same as 2) but including a 'high-protein' reformulation; 4) same as 3) but including a minimal physical activity component. Each strategy is followed until the end of follow-up. Participants assigned to a lifestyle strategy are expected to maintain their dietary intake or amount of physical activity at or above the prespecified threshold by the corresponding intervention strategy.\nSame. We will assume that each dietary assessment period (i.e., within 2 months beginning at each timepoint) accurately reflects the average diet in the interval between follow-ups.\n\n\nAssignment\nParticipants are randomly assigned to a dietary strategy, but are not blinded to their assignment.\nWe will attempt to emulate randomized assignment by adjusting for dietary intakes before baseline and baseline covariates.\n\n\nOutcomes\nPhysical function and muscle strength, general health indicators, and cognitive health\nSame.\n\n\nTime zero and follow-up\nStarts at baseline and ends at incomplete follow-up, or 3 y after baseline, whichever occurs first.\nSame. An incomplete follow-up is defined as missing data for questionnaires (non-response or loss to follow-up) or missing outcome data at the end of follow-up.\n\n\nCausal contrast3\n• Intention-to-treat effect • Per-protocol effect\nObservational analog of both contrasts: • Intention-to-treat effect (secondary) • Per-protocol effect (primary)\n\n\nStatistical analysis\n• Intention-to-treat analysis: apply inverse probability weighting with adjustment for pre- and baseline factors associated with incomplete follow-up to account for study dropouts • Per-protocol analysis: apply the parametric g-formula algorithm to compare post-intervention outcomes between groups receiving each treatment strategy with adjustment for pre- and postbaseline factors associated with adherence to intervention strategies and incomplete follow-up.\nSame for both contrasts. Except that the observational analog will require additional adjustment for confounding at baseline and before baseline due to prior diet.\n\n\n\n1 FFQ, food-frequency questionnaire; NuAge, Quebec Longitudinal Study on Nutrition and Successful Aging\n\n\n2 See 'Dietary Strategies' for detailed intervention.\n\n\n3 The observational analog of the intention-to-treat contrast corresponds to the baseline values of the intervention, which are both 'assigned' and initiated at the same time.\n\n\n\n\n\n\n\n\nCode\n# ********************************************** #\n#                   Save table                   #\n# ********************************************** #\n\ngt::gtsave(tab_targettrial,\n           filename = file.path(dir_tab,\"tab_targettrial.docx\"))\n\n\nEach part of the target trial and its emulation are described below.\n\nEligibility Criteria\nThe inclusion criteria for the target trial are the same as for the NuAge study [25]. In the emulation, participants will be required to have at least one 24-hour dietary recall completed at baseline with 500 calories or more, as well as complete covariate data at baseline, as identified below.\n\n\nHypothetical Interventions\nThe hypothetical intervention strategies evaluated will be:\n\nno change in dietary habits or physical activity (“control” intervention);\nadherence to CFG’s recommendations;\nadherence to CFG’s recommendations including reformulation (i.e., higher intake of protein foods);\nadherence to CFG’s recommendations including reformulation (i.e., higher intake of protein foods) and performing at least 30 minutes of aerobic physical activity.\n\nPhysical activity recommendations are not traditionally at the forefront of CFG’s recommendations. However, CFG does mention that “at least 150 minutes of moderate-to vigorous-intensity aerobic physical activity per week […] is recommended to achieve health benefits” [1]. Thus, recognizing the key role of exercise to maintaining health and muscle for older adults, the 4th hypothetical intervention includes a formal physical activity recommendation. In the target trial, the physical activity corresponds to performing aerobic exercise of light to vigorous-intensity aerobic for at least 30 minutes per day [6].\n\nThe challenge of a well-defined nutritional intervention\nEmulating a well-defined dietary intervention for CFG’s recommendations is challenging. First, recommendations in the latest edition of CFG are qualitative and flexible (e.g., “Eat plenty of vegetables and fruits”; [1,29]). Thus, multiple suitable, but nonetheless very different, dietary patterns can achieve adherence to recommendations. Second, CFG’s recommendations target both food intakes (e.g., vegetables and fruits) and nutrients (e.g., saturated fats). The nutrient-based recommendations can be achieved by intervening on the consumption of multiple different foods. For example, to achieve the hypothetical intervention “decreasing consumption of calories from saturated fats” one could decrease saturated fats from dairy, nuts and low nutritive value foods altogether. Arguably, the relationship between these food categories and a given health outcome may vary greatly.\nTo estimate a causal effect using observational data, the hypothetical interventions must be sufficiently well-defined or that until “no meaningful variation” of that intervention remains [30,31]. In other words, the hypothetical diet interventions should be elaborated until no additional dietary characteristics are deemed impactful in regards of the outcome of interest. Another consideration is that the modelling of hypothetical interventions should ideally be conducted with dietary intakes expressed using the same units. For example, mixing food intakes expressed in servings and grams in a statistical model may cause poor estimation of causal effects [17]. Finally, the statistical approach used to account for ‘total energy’ or total food intake also affects the causal effect of interest and should be consistent with the research question [17,31–33].\n\n\nDiet Simulations\n\n\nCode\n# ********************************************** #\n#             Output sim. diet data              #\n# ********************************************** #\n\n# note: loading done in set-up chunk. See code &lt;1.0-Data_preparation.R&gt; for details\n\n# ********************************************** #\n#          Output vectors of CFG foods           #\n# ********************************************** #\n\nrecommended &lt;- c(\n  \"vegetables and fruits\",\n  \"whole-grain foods\",\n  \"protein foods\",\n  \"unsweetened milk and plant-based beverages with protein\"\n)\n\nnotrecommended &lt;- c(\n  \"non-whole grain foods\",\n  \"other low nutritive value foods\",\n  \"juice, sugary drinks and alcohol\",\n  \"fatty foods rich in saturated fats\")\n\n\nFor the present study, adherence to CFG’s recommendations was defined based on simulated diets generated by Health Canada [34] and summarized in Supplemental Table 1. The simulated diets were designed to meet both CFG’s recommendations on healthy food choices and nutrient requirements (Dietary Reference Intake).\nThese diets achieve near perfect Healthy Eating Food Index (HEFI)-2019 scores (&gt;78/80) through relatively high intakes of recommended foods (i.e., vegetables and fruits, whole-grain foods, protein foods, and unsweetened milk and plant-based beverages with protein) and null intakes of foods not recommended (i.e., non-whole grain foods, other low nutritive value foods, juice, sugary drinks and alcohol, and fatty foods rich in saturated fats). The HEFI-2019 score indicates the extent to which dietary intakes are consistent with CFG’s recommendations on healthy food choices [29,35].\nNote that the HEFI-2019 could have been used as main exposure to measure adherence to CFG. However, the use of a composite score metric would not fully satisfy the criterion of a well-defined intervention to estimate a causal effect. First, high HEFI-2019 scores, and high adherence to CFG’s recommendations, can be achieved through many different strategies or dietary patterns. In the context of observational data, the specific strategies through which individuals achieve high HEFI-2019 score would be based on dietary habits and patterns self-selected by the participants. This approach is similar to asking hypothetical trial participants to modify their intakes without clearly indicating how, which would obscure the causal effect estimated. Second, the HEFI-2019 score includes recommendations both on foods and on nutrients. As described above, mixing servings and grams in a statistical models may cause poor estimation of causal effects [17].\nWe stress that the diets simulated by Health Canada were not actually consumed by older adults. For this reason, the simulated values for vegetables and fruits, whole-grain foods and plant-based protein foods exceed the 99th percentile of the distribution of usual intakes of these food categories as estimated in adults aged 65 years or more from the Canadian Community Health Survey 2015 - Nutrition [3]. In Table 2, the target intakes vegetables and fruits, whole grains, and plant-based protein foods for the adhering to Canada’s Food Guide 2019 recommendations intervention were revised to correspond, at most, to the 90th percentile of the distribution of usual intakes among Canadians aged 65 years or more in 2015 [3]. Since Canada’s Food Guide 2019 does not have a portion size system, reference amounts (RA) were used as a proxy for servings. RA are regulated quantity of foods that reflect the portion size typically consumed at 1 sitting in Canada. RA were used by Health Canada to simulate diet consistent with Canada’s Food Guide 2019 recommendations and Dietary Reference Intake (Supplemental Table 1), hence RAs are adequate for the present work.\n\n\nImplementation\nIn the target trial, the sustained intervention strategy could be implemented as follows:\n\nthe participant’s usual dietary intakes and physical activity would be assessed by research dietitians at each study visit;\nif reported food intakes and duration of physical activity were equal to or above the prespecified thresholds (Table 2), no change would be suggested to the participants’ diet or physical activity If food intakes or duration of physical activity were below the prespecified thresholds, participants would be instructed to increase food consumption to exactly the prespecified portions or increase physical activity duration to 30 minutes per day (when applicable);\nif changes are required, participants would be instructed to decrease consumption of foods not recommended to the extent of the increase in (2). For example, if a 2-serving increase in vegetables and fruits is required to meet the pre-specified intervention thresholds, participants would be instructed to substitute 2 servings of vegetables and fruits for non-whole grain foods, other low nutritive value foods, juice, sugary drinks and alcohol, and fatty foods rich in saturated fats.\n\nIn the emulation, for all hypothetical interventions, the substitution will be implemented by including “total intakes” as a covariate and leaving out foods not recommended from the models. More precisely, a variable reflecting total food intake (in RA/day) and a variable reflecting total beverage intake (in RA/day) will be included in all models. Hence, total food and beverage intakes will be constant across hypothetical diet interventions. In this approach to account for “total energy”, all model coefficients reflect the action of increasing intakes of recommended foods and a concomitant decrease in any of the foods not recommended [32]. On the one hand, this approach is potentially confusing [17,33], since the default interpretation of model coefficients is the action of increasing the intake of each food included in the model, while decreasing the intake of foods not in the model [32]. On the other hand, the standard model is generally consistent with the implementation of dietary intervention in feeding trials [16,36,37]. The standard model also reduces the number of variables to be considered as intervention variables. Otherwise, 4 additional dietary components would have to be modelled for foods not recommended (i.e., non-whole grain foods, other low nutritive value foods, juice, sugary drinks and alcohol, and fatty foods rich in saturated fats). Finally, the explicit description of the intervention strategies in the target trial protocol clarifies the estimand of interest, as done previously [19,31].\nOf note, nutrient-based recommendations in CFG (i.e, saturated fats, free sugars and sodium) are not explicitly modelled to avoid the problems associated with mixed-unit models [17]. In the target trial, we assume that nutrient-based targets would be met by reducing consumption of foods not recommended (i.e., non-whole grain foods, other low nutritive value foods, juice, sugary drinks and alcohol, and fatty foods rich in saturated fats). In that regard, food-level substitution analyses in Canadians support this assumption for saturated fats [38,39].\n\n\n\nCode\n# #| label: tbl-dietint\n# #| tbl-cap: \"Diet intervention\"\n\n# *********************************************************************** #\n#                Generate table presenting interventions                  #\n# *********************************************************************** #\n\n# ********************************************** #\n#     CFG reformulation intervention values      #\n# ********************************************** #\n\npfab_int &lt;- 1.5\npfpb_int &lt;- 0.5\nmilk_int &lt;- 0.5\n\n# ********************************************** #\n#             Full intervention data             #\n# ********************************************** #\n\ndata_dietint &lt;- \n  readxl::read_excel(file.path(dir_results,\"Table_data.xlsx\"),\n                   sheet = \"dietint\") |&gt;\n  # Indicate values that are unchanged by intervention\n  mutate(\n  ## Animal-based protein intervention\n    pfab = ifelse(int&gt;2, pfab+pfab_int, pfab),\n  ## Plant-based protein intervention\n    pfpb = ifelse(int&gt;2, pfpb+pfpb_int, pfpb),\n  ## Milk and pant beverages with sufficient protein\n    milk_plantbev = ifelse(int&gt;2, milk_plantbev+milk_int, milk_plantbev),\n  ## add labels and common values\n    dietsuppl = ifelse(int&gt;1, \"No change\",dietsuppl),\n    exercise  = ifelse(int&gt;1 & int!=4, \"No change\",exercise),\n    across(c(\"otherfoods\", \"otherbev\", \"rg\"),\n           function(x) ifelse(int&gt;1 & is.na(x),\"Minimum\",x))\n  )\n\n# add factor for clean labels\ndata_dietint$drig_f &lt;- \n  factor(data_dietint$drig,\n         levels=c(0,12,13,14,15),\n         labels = c(\"All, 51y+\",\n                    \"Males, 67-70 y\",\n                    \"Females, 67-70 y\",\n                    \"Males\",\n                    \"Females\"))\n\ndata_dietint$int_f &lt;- \n  factor(data_dietint$int,\n         levels=c(1,2,3,4),\n         labels = c(\"1. Control (no change)\",\n                    \"2. Adhering to Canada's Food Guide 2019 recommendations on healthy food choices\",\n                    \"3. Same as 2 + extra protein\",\n                    \"4. Same as 3 + physical activity\"))\n\n# ********************************************** #\n#                 Generate table                 #\n# ********************************************** #\n\ntab_dietint &lt;- \n  data_dietint |&gt;\n  group_by(int_f) |&gt;\n  gt::gt() |&gt;\n  gt::cols_move_to_start(columns=c(int_f,drig_f)) |&gt;\n  gt::cols_move_to_end(columns=c(exercise)) |&gt;\n  gt::cols_hide(columns = c(drig,int)) |&gt;\n  gt::tab_spanner(label=\"Recommended foods, RA/day\",\n                  columns = c(vf,wg,pfpb,pfab, milk_plantbev, ufa)) |&gt;\n  gt::tab_spanner(label=\"Foods and beverages not recommended, RA/day\",\n                  columns = c(otherfoods, otherbev, rg)) |&gt;\n  gt::cols_label(\n    int    = \"Intervention\",\n    drig_f = \"Sex\",\n    vf     = \"Vegetables & fruits\",\n    wg     = \"Whole grains\",\n    pfpb   = \"Protein foods, plant-based\",\n    pfab   = \"Protein foods, animal-based\",\n    milk_plantbev = \"Milk & Plant-based bev. with protein\",\n    ufa    = \"Unsaturated oils & fats\",\n    dietsuppl = \"Dietary supplement\",\n    otherfoods = \"Other foods\",\n    otherbev = \"Sugary drinks, alcohol\",\n    rg       = \"Non-whole grains\",\n    exercise = \"Physical activity, minutes/day\") |&gt;\n  gt::sub_missing(missing_text =\"-\") |&gt;\n  gt::tab_header(\n     title = \"Hypothetical diet and exercise interventions emulated in the NuAge cohort study, by sex\") |&gt;\n  gt::tab_footnote(\n    footnote = glue::glue(\"The emulation of all hypothetical interventions will be implemented using a substitution approach in statistical models. In all models, one variable for 'total food intake' and one variable for 'total beverage intake' will be included, and foods not recommended will be left out from the models (i.e., {knitr::combine_words(notrecommended)}). CFG, Canada's Food Guide; NuAge, Quebec Longitudinal Study on Nutrition and Successful Aging; RA, reference amount; y, year\"),\n    locations = cells_title(\"title\")\n    ) |&gt;\n  # Indicate what are 'control' values\n  gt::tab_footnote(\n    footnote = \"Values are averages observed at baseline in the NuAge cohort. In other words, values are the observed intakes for the food categories or amount of physical activity when no change is applied.\",\n    locations = cells_row_groups(groups = attributes(data_dietint$int_f)$levels[1])\n    ) |&gt;\n  # Indicate what are 'CFG adherence' values\n  gt::tab_footnote(\n    footnote = \"Values are derived from Health Canada's simulated composite diets of adults 71 years or older. Participants would be expected to meet these targets for each food categories. The specific food choices within these categories would be at the participants' discretion. Values for vegetables and fruits, whole-grain foods and plant-based protein foods were truncated to correspond, at most, to the 90th percentile of the distribution of usual intakes among Canadians aged 65 years in 2015.\",\n    locations = cells_row_groups(groups = attributes(data_dietint$int_f)$levels[2])\n    ) |&gt;\n  # Indicate what is the extra protein treatment\n  gt::tab_footnote(\n    footnote = glue::glue(\"Extra protein foods were added as follows: +{pfpb_int} RA of plant-based protein foods (e.g., {pfpb_int*50} grams of nuts), +{pfab_int} RA of animal-based protein foods (e.g., {pfab_int*100} grams of cooked unprocessed red meat, fish or poultry or {round(pfab_int*100/50)} small eggs), +{milk_int} RA of milk or plant-based beverage with protein (e.g., {milk_int*250} ml of milk or plant-based beverages with sufficient protein).\"),\n    locations = cells_row_groups(groups = attributes(data_dietint$int_f)$levels[3])\n    ) |&gt;\n  # Indicate meaning of dietary supplement column\n  gt::tab_footnote(\n    footnote = \"Dietary supplements were not intervened on, but were nonetheless excluded from foods and beverages not recommended to avoid being considered in the substitution. In other words, participants would be not be instructed to modify their dietary supplements in the hypothetical trial.\",\n    locations = cells_column_labels(columns=\"dietsuppl\")\n    ) |&gt;\n  # Describe exercise\n  gt::tab_footnote(\n    footnote = \"Physical activity corresponds to aerobic exercise of moderate intensity or higher (Bauer et al. 2013).\",\n    locations=cells_column_labels(columns=\"exercise\")\n  ) |&gt;\n  # Indicate what are 'Minimum' values\n  gt::tab_footnote(\n    footnote = \"Minimum indicates that consumption would be set at the smallest amount permitting a concomitant increase in recommended foods to meet Canada's Food Guide targets. Portions for foods not recommended may vary on an individual basis.\",\n    locations = cells_column_spanners(spanners=\"Foods and beverages not recommended, RA/day\")\n    #cells_body(columns=c(\"otherfoods\":\"rg\"),rows=3:nrow(data_dietint) )\n    ) \n\n# ********************************************** #\n#                  Print table                   #\n# ********************************************** #\n\nif(print_table==\"Y\") {\n  tab_dietint |&gt; gtstyle()\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHypothetical diet and exercise interventions emulated in the NuAge cohort study, by sex1\n\n\nSex\n\nRecommended foods, RA/day\n\nDietary supplement3\n\nFoods and beverages not recommended, RA/day2\n\nPhysical activity, minutes/day4\n\n\nVegetables & fruits\nWhole grains\nProtein foods, plant-based\nProtein foods, animal-based\nMilk & Plant-based bev. with protein\nUnsaturated oils & fats\nOther foods\nSugary drinks, alcohol\nNon-whole grains\n\n\n\n\n1. Control (no change)5\n\n\nMales\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n\n\nFemales\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n-\n\n\n2. Adhering to Canada's Food Guide 2019 recommendations on healthy food choices6\n\n\nMales\n6\n1.5\n1.0\n2.0\n1.0\n1\nNo change\nMinimum\nMinimum\nMinimum\nNo change\n\n\nFemales\n5\n1.5\n0.8\n1.5\n1.0\n1\nNo change\nMinimum\nMinimum\nMinimum\nNo change\n\n\n3. Same as 2 + extra protein7\n\n\nMales\n6\n1.5\n1.5\n3.5\n1.5\n1\nNo change\nMinimum\nMinimum\nMinimum\nNo change\n\n\nFemales\n5\n1.5\n1.3\n3.0\n1.5\n1\nNo change\nMinimum\nMinimum\nMinimum\nNo change\n\n\n4. Same as 3 + physical activity\n\n\nMales\n6\n1.5\n1.5\n3.5\n1.5\n1\nNo change\nMinimum\nMinimum\nMinimum\n30 or more\n\n\nFemales\n5\n1.5\n1.3\n3.0\n1.5\n1\nNo change\nMinimum\nMinimum\nMinimum\n30 or more\n\n\n\n1 The emulation of all hypothetical interventions will be implemented using a substitution approach in statistical models. In all models, one variable for 'total food intake' and one variable for 'total beverage intake' will be included, and foods not recommended will be left out from the models (i.e., non-whole grain foods, other low nutritive value foods, juice, sugary drinks and alcohol, and fatty foods rich in saturated fats). CFG, Canada's Food Guide; NuAge, Quebec Longitudinal Study on Nutrition and Successful Aging; RA, reference amount; y, year\n\n\n2 Minimum indicates that consumption would be set at the smallest amount permitting a concomitant increase in recommended foods to meet Canada's Food Guide targets. Portions for foods not recommended may vary on an individual basis.\n\n\n3 Dietary supplements were not intervened on, but were nonetheless excluded from foods and beverages not recommended to avoid being considered in the substitution. In other words, participants would be not be instructed to modify their dietary supplements in the hypothetical trial.\n\n\n4 Physical activity corresponds to aerobic exercise of moderate intensity or higher (Bauer et al. 2013).\n\n\n5 Values are averages observed at baseline in the NuAge cohort. In other words, values are the observed intakes for the food categories or amount of physical activity when no change is applied.\n\n\n6 Values are derived from Health Canada's simulated composite diets of adults 71 years or older. Participants would be expected to meet these targets for each food categories. The specific food choices within these categories would be at the participants' discretion. Values for vegetables and fruits, whole-grain foods and plant-based protein foods were truncated to correspond, at most, to the 90th percentile of the distribution of usual intakes among Canadians aged 65 years in 2015.\n\n\n7 Extra protein foods were added as follows: +0.5 RA of plant-based protein foods (e.g., 25 grams of nuts), +1.5 RA of animal-based protein foods (e.g., 150 grams of cooked unprocessed red meat, fish or poultry or 3 small eggs), +0.5 RA of milk or plant-based beverage with protein (e.g., 125 ml of milk or plant-based beverages with sufficient protein).\n\n\n\n\n\n\n\n\nCode\n# ********************************************** #\n#                   Save table                   #\n# ********************************************** #\n\ngt::gtsave(tab_dietint,\n           filename = file.path(dir_tab,\"tab_dietint.docx\"))\n\n\nThe “additional protein” intervention consists of increasing the intake of both animal-based and plant-based protein foods by 1.5 and 0.5 RA per day, respectively, as well as milk and plant-based beverages with sufficient protein by 0.5 RA per day. In terms of amount of food, this corresponds to adding 150 grams of cooked unprocessed red meat, fish or poultry or 3 small eggs, 25 grams of nuts and seeds and 125 ml of milk or plant-based beverages with sufficient protein, while proportionally decreasing the intake of foods not recommended. In a previous RCT [40], older women aged 60 to 90 years were able to consume an additional 160 grams of cooked lean red meat without substitution, hereby supporting the feasibility of the protein intervention in the present hypothetical study.\n\n\n\n\nAssignment\nRandom allocation (randomization) will be emulated by adjusting for dietary intakes in the year prior to the intervention, as well as adjusting for covariates at the start of the study. Covariates were identified using the causal diagrams depicted in Figure 1 based on background knowledge of the relationship between the hypothetical lifestyle intervention and outcomes.\nDietary components that are the foundation for healthy eating in CFG include intakes of vegetables and fruits, whole grains, protein foods (plant- and animal-based protein foods, milk and plant-based beverages with protein), unsaturated oils and fats [1].\nCovariates include age at baseline, biological sex, region, education, living alone, smoking and drinking (alcohol) habits, major chronic diseases (i.e., hypertension, diabetes, cancer, heart disease), number of medications, supplement use (e.g., vitamins and minerals), living alone, and height and weight.\n\n\\(Z\\), baseline covariates: age, sex, region, education, history of smoking, height, former cancer.\n\\(P\\), prior exposure (i.e., exposure of time-varying intervention prior to baseline): dietary habits before baseline\n\\(L\\), (time-varying) covariates: weight, number of medications, supplement use, living alone, major chronic diseases (hypertension, diabetes, cancer, heart disease), smoking and alcohol habits\n\\(X\\), (time-varying) treatment: diet and physical activity habits\n\\(Y\\), end of follow-up outcome: muscle health, general health, cognitive health.\n\n\n\nCode\n# ********************************************** #\n#           Input Dagitty information            #\n# ********************************************** #\n\n# Dagitty frame\ndag_rand_generic &lt;-\n dagitty::dagitty(\n'dag {\nbb=\"0,0,1,1\"\n\"P-1\" [pos=\"0.100,0.300\",Xdjusted=\"1\"]\nL0 [pos=\"0.250,0.500\",Xdjusted=\"1\"]\nX0 [exposure,pos=\"0.300,0.300\"]\nY [outcome,pos=\"0.527,0.300\"]\nZ [pos=\"0.100,0.400\"]\n\"P-1\" -&gt; L0\n\"P-1\" -&gt; X0\n\"P-1\" -&gt; Y [pos=\"0.260,0.400\"]\nL0 -&gt; X0\nL0 -&gt; Y\nX0 -&gt; Y\nZ -&gt; L0\nZ -&gt; X0\nZ -&gt; Y\n}')\n\n# Transform to ggdag\ndag_rand_generic &lt;- ggdag::tidy_dagitty(dag_rand_generic)\n\n# Generate second set of coordinates for edge-arc \ndag_rand_generic &lt;- \n  dag_rand_generic |&gt;\n    mutate(\n    ## create second set of coordinates for edge-arc\n    # x coordinates\n    xend_arc = case_when(\n     name==\"P-1\" & to ==\"Y\" ~ xend ,\n     .default = NA \n    ),\n    # y coordinates\n    yend_arc = case_when(\n      name==\"P-1\" & to ==\"Y\" ~ yend ,\n      .default = NA \n    ),\n    # remove straight edge for those flag with arc\n    xend = ifelse(is.na(xend_arc),xend,NA),\n    yend = ifelse(is.na(yend_arc),yend,NA),\n    )\n\n\n# *********************************************************************** #\n#                   Generate panel A with confounding                     #\n# *********************************************************************** #\n\n# ********************************************** #\n#              Labelling and colors              #\n# ********************************************** #\n\n# Use default color to draw attention to the path of interests\ndefault_colour &lt;- \"black\"\nhighlight_colour &lt;- \"#a82203\" # MetBrewer::met.brewer(\"Juarez\",n=1)\n\n# Add colors\ndag_rand_unadjust &lt;- \n  dag_rand_generic  |&gt;\n  mutate(\n    name_colour = ifelse(name!=\"X0\",highlight_colour,default_colour),\n    name_line = \"solid\"\n  ) \n\nname_colour &lt;-\n  c(\n    \"X0\" = default_colour,\n    \"L0\" = highlight_colour,\n    \"Y\" = default_colour,\n    \"P-1\" = highlight_colour, \n    \"Z\" = highlight_colour\n  )\n\n# add nodes label for ggplot\ndag_rand_unadjust_labels &lt;-\n  data.frame(dag_rand_unadjust) |&gt;\n  dplyr::mutate(\n    label = case_when(\n    name ==\"X0\"~\"X\\u2080\",\n    name ==\"L0\" ~ \"L\\u2080\",\n    name ==\"Y\"  ~ \"Y\",\n    name ==\"P-1\" ~ \"P\",\n    name == \"Z\" ~ \"Z\")\n  ) |&gt;\n  dplyr::pull(label)\n\n# ********************************************** #\n#             Create DAG with ggplot             #\n# ********************************************** #\n\nmake_dag_rand_A &lt;- function(scale_node_size=1, text_size=4, default_node_size=16){\n  \n  # note: text size default is 4\n  \n  # calculate node size as a factor x default\n  node_size &lt;- default_node_size * scale_node_size\n\nfig_dag_rand_unadjust &lt;-\n  dag_rand_unadjust  |&gt;\n  ggplot(aes(\n    x = x,\n    y = y,\n    xend = xend,\n    yend = yend\n  )) +\n  geom_dag_point(aes(colour = name),size = node_size,show.legend=FALSE) +\n  geom_dag_edges(aes(edge_colour   = name_colour,\n                     edge_linetype = name_line)) +\n  geom_dag_edges_arc(aes(xend         = xend_arc,\n                        yend          = yend_arc,\n                        edge_colour   = name_colour,\n                        edge_linetype = name_line),curvature=0.25) +\n  scale_colour_manual(values = name_colour) +\n  geom_dag_text(aes(label=dag_rand_unadjust_labels), size=text_size) +\n  theme_dag()\n\nreturn(fig_dag_rand_unadjust)\n\n}\n\n# Generate figure for different layout\n\n## normal version\nfig_unadjust_normal &lt;- \n  make_dag_rand_A(text_size=7) + \n  labs(title=\"**(A)** Confounding at baseline\") + \n  theme(plot.title = ggtext::element_markdown())\n\n## JMIR format\nfig_unadjust_jmir &lt;- \n  make_dag_rand_A(scale_node_size=0.5, text_size=3.5) + \n  labs(title=\"**(A)** Confounding at baseline\") + \n  theme(plot.title = ggtext::element_markdown(size=10))\n\n## JMIR TOC figure\nfig_dag_unadjust_jmir_toc &lt;- \n  make_dag_rand_A(scale_node_size=0.5, text_size=3.5) + \n  theme(\n    plot.title = ggtext::element_markdown(size=10),\n    panel.background = element_rect(fill = \"white\", color=NA), \n    plot.background = element_rect(fill = \"white\", color=NA)\n  )\n\n# *********************************************************************** #\n#                  Generate panel B without confounding                   #\n# *********************************************************************** #\n\n#note: starts based on 'dag_rand_generic' created above, but colors and path updated to highlight adjustment\n  \n# ********************************************** #\n#              Labelling and colors              #\n# ********************************************** #\n  \n# Use default color to draw attention to the path of interests\ndefault_colour &lt;- \"black\"\nhighlight_colour &lt;- \"darkgray\" \n\n# Add colors\ndag_rand_adjust &lt;- \n  dag_rand_generic  |&gt;\n  mutate(\n    # Color of point/edge/lines\n    name_colour = highlight_colour,\n    name_colour = ifelse(name==\"X0\" & to==\"Y\", default_colour, name_colour),\n    name_line = \"solid\"\n  )  |&gt;\n  # Remove confounding as estimated in a pseudo-population\n  filter(!(to==\"X0\" & name %in% c(\"P-1\", \"Z\", \"L0\")))\n\nname_colour &lt;-\n  c(\n    \"X0\" = default_colour,\n    \"L0\" = highlight_colour,\n    \"Y\" = default_colour,\n    \"P-1\" = highlight_colour, \n    \"Z\" = highlight_colour\n  )\n\n# add nodes label for ggplot\ndag_rand_adjust_labels &lt;-\n  data.frame(dag_rand_adjust) |&gt;\n  dplyr::mutate(\n    label = case_when(\n    name ==\"X0\"~\"X\\u2080\",\n    name ==\"L0\" ~ \"L\\u2080\",\n    name ==\"Y\"  ~ \"Y\",\n    name ==\"P-1\" ~ \"P\",\n    name == \"Z\" ~ \"Z\")\n  ) |&gt;\n  dplyr::pull(label)\n\n# ********************************************** #\n#             Create DAG with ggplot             #\n# ********************************************** #\n\nmake_dag_rand_B &lt;- function(scale_node_size=1, text_size=4, default_node_size=16){\n  \n  # calculate node size as a factor x default\n  node_size &lt;- default_node_size * scale_node_size\n\nfig_dag_rand_adjust &lt;-\n  dag_rand_adjust  |&gt;\n  ggplot(aes(\n    x = x,\n    y = y,\n    xend = xend,\n    yend = yend\n  )) +\n  geom_dag_point(aes(colour = name),size = node_size,show.legend=FALSE) +\n  geom_dag_edges(aes(edge_colour   = name_colour,\n                     edge_linetype = name_line)) +\n  geom_dag_edges_arc(aes(xend         = xend_arc,\n                        yend          = yend_arc,\n                        edge_colour   = name_colour,\n                        edge_linetype = name_line),curvature=0.25) +\n  scale_colour_manual(values = name_colour) +\n  geom_dag_text(aes(label=dag_rand_adjust_labels), size=text_size) +\n  theme_dag()\n\nreturn(fig_dag_rand_adjust)\n\n}\n\n# Generate figure for different layout\n\n## normal version\nfig_adjust_normal &lt;- \n  make_dag_rand_B(text_size=7) + \n  labs(title=\"**(B)** Successful emulation of randomization\") +\n  theme(plot.title = ggtext::element_markdown())\n\n## JMIR format\nfig_adjust_jmir &lt;- \n  make_dag_rand_B(scale_node_size=0.5, text_size=3.5) + \n  labs(title=\"**(B)** Successful emulation of randomization\") +\n  theme(plot.title = ggtext::element_markdown(size=10))\n\n# *********************************************************************** #\n#                Append both DAG with/without confounding                 #\n# *********************************************************************** #\n\n# note: done using patchwork library\n\nfig_dag_rand_normal &lt;- fig_unadjust_normal / fig_adjust_normal\n\nfig_dag_rand_jmir &lt;- fig_unadjust_jmir / fig_adjust_jmir\n\n \n# ********************************************** #\n#                Save as png/pdf                 #\n# ********************************************** #\n  \n# Normal version, pdf and png\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_rand.pdf\"),\n                plot=fig_dag_rand_normal, dpi=300, width=8,height=8, units=\"in\",scale=1,device = cairo_pdf)\n\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_rand.png\"),\n                plot=fig_dag_rand_normal, dpi=300, width=8,height=8, units=\"in\",scale=1)\n\n# JMIR scaling (max. 1200x1200)\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_rand_jmir.png\"),\n                plot=fig_dag_rand_jmir, dpi=300, width=1200,height=1200, units=\"px\",scale=1)\n\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_rand_jmir.pdf\"),\n                plot=fig_dag_rand_jmir, dpi=300, width=1200,height=1200, units=\"px\",scale=1, device = cairo_pdf)\n\n# JMIR scaling, for TOC (max. 1200x900)\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_unadjust_jmir_toc.png\"),\n                plot=fig_dag_unadjust_jmir_toc, dpi=300, width=1200,height=800, units=\"px\",scale=1)\n\n  \n# ********************************************** #\n#              Load rendered figure              #\n# ********************************************** #\n  \nknitr::include_graphics(file.path(dir_fig,\"fig_dag_rand.png\"))\n\n\n\n\n\n\n\n\nFigure 1: Causal directed acyclic graph (DAG) depicting (A) confounding and (B) successful emulation of randomization using g-methods at baseline between the intervention strategy (X) and outcome (Y). Baseline covariates (both time-invariant [Z] and time-varying [L]) and previous diet and physical activity habits (P) must be considered to emulate randomization. Time-varying treatment and covariates are not shown in this DAG to focus on randomization emulation. Subscripts indicate the time points, where 0 represents baseline.\n\n\n\n\n\nContrary to dietary habits, data on physical activity habits before baseline were not collected in the NuAge study. In this case, the potential effect of prior physical activity habits will not be accounted for in the models that aim at emulating the sustained physical activity intervention strategy. For the models emulating the sustained diet intervention strategy only, physical activity habits during the study will be used as covariate, hence mitigating the confounding of prior physical activity, at least to some extent.\nA successful emulation of randomization requires that there is no unmeasured confounding. However, this is never guaranteed with observational data. Thus, we emphasize our assumptions that 1) the causal graph accurately depicts the relationship under study; and 2) the covariates included are a sufficient set of covariates to address confounding.\n\n\nOutcomes\nThe primary outcomes will be the mean end of follow-up values for muscle strength (i.e., handgrip using vigorimeter, elbow flexor, knee extensor) and physical function (i.e., normal and fast walking, “timed up-and-go”). Outcome values were measured according to standardized protocol in NuAge [25].\nFor secondary outcomes, mean end of follow-up values for a set of relevant variables will be considered by domains:\n\nGeneral health: waist circumference, blood pressure (systolic, diastolic), blood glucose, estimated glomerular filtration rate;\nCognition: the modified Mini-Mental State Examination (3MS) score.\n\n\n\nTime Zero and Follow-up\nIn the target trial of a sustained lifestyle intervention, participants would be met at baseline and then regularly to ensure that diet and physical activity habits are consistent with the intervention assigned by the random allocation. The hypothetical diet and physical activity intervention would be assigned and initiated at baseline. In the emulation, annual follow-ups with comprehensive diet, physical activity and covariate data collection are available to emulate the hypothetical intervention. Hence, participants would be followed from study baseline (time 0; i.e., the time at which the intervention strategy would also be assigned and would begin), at each year (time 1 and 2) and until the end of the study (time 3). We also assume that the diet and physical activity habits measured at each follow-up time adequately reflect the habits during the full year.\nThe end of follow-up outcome measurements will be used to estimate the effect of the sustained lifestyle intervention strategy. Measures of dietary intakes and physical activity throughout the study (i.e., time 0 to time 3) will be used to emulate the sustained lifestyle intervention. Dietary intakes in the year prior to the intervention will be estimated using the frequency questionnaire completed at study baseline (time 0). Missing covariate data at a given follow-up will be carried forward once, after which participants will be considered as having incomplete follow-up.\n\n\nCausal Contrast\nThe estimand of interest in this study, the target causal effect of a sustained lifestyle intervention strategy, is\n\\[\nE(Y^{1,1,1,1} |C=0)-E(Y^{0,0,0,0} |C=0)\n\\tag{1}\\]\nthat is, the expected value of a given health outcome \\(Y\\) at the end of follow-up if all participants had increased their adherence to CFG recommendations on healthy food choices and physical activity, when applicable, at all four time points (\\(X_k=1\\), “always intervene”) vs., instead, if all participants had maintained their habitual diet and physical activity (\\(X_k=0\\), “never intervene”). The estimand (Equation 1) also indicates that all participants completed the intervention (\\(C=0\\)), i.e., in absence of incomplete follow-up.\nThe causal contrasts of interest are the observational analogues of “intention-to-treat” and “per protocol” [11]. Given the observational design, participants are not expected to have followed a treatment strategy unknown to them at the time of data collection. Therefore, the primary analysis will be the per protocol contrast of a sustained lifestyle intervention strategy. In the per protocol analysis, non-adherence to the hypothetical interventions can be accounted for. In the target trial, participants with a condition after baseline that would have prevented or limited participation in a hypothetical lifestyle intervention would be allowed to discontinue the intervention (e.g., lengthy hospitalization, prolonged bed rest, incident cancer). In the emulation, if such conditions occur in a sufficiently large number of participants, these participants will be “excused” from following the hypothetical intervention [23]. In other words, participants that would have been unable to pursue the study due to major events will not be considered as having incomplete follow-up if they attended the annual assessment. Allowing participants to discontinue adhering to the (hypothetical) intervention strategy mitigates confounding by the disease burden [23].\nThe intention-to-treat analysis will be a secondary analysis of a hypothetical point intervention, e.g., dietary counselling at baseline only. Note that it will not be possible to conduct an intention-to-treat analysis identical to that of a controlled study where the interest is to estimate the effect of being assigned to an intervention [11]. However, it is possible to conduct an “observational analogue” of the intention-to-treat analysis. In the observational analogue, the intention-to-treat analysis aims to estimate the impact of a hypothetical intervention which adherence is measured at baseline only.\n\n\nStatistical Analysis\nStratification and multivariable regression (i.e., covariate adjustment) are conventional statistical approaches to address confounding in nutritional epidemiology. However, the conventional approaches are not adequate to estimate cumulative treatment effects (e.g., diet over time) in the presence of time-varying confounding (e.g., weight status over time) and treatment (e.g., prior diet) [41,42]. In the present study, non-adherence to the hypothetical interventions and incomplete follow-up will be considered using (general) g methods for the per protocol analysis [11,42]. Among g methods, the parametric g-formula provides the most flexibility for analyses involving hypothetical dietary interventions, as used previously [19,22,43]. Briefly, in the context of an observational study, the parametric g formula, and its implementation into an R package [44], uses parametric models to predict the joint-history of prior diet and physical activity habits (i.e., the hypothetical sustained intervention strategy) and confounding variables. For example, linear regression models are used to predict continuous covariates (e.g., body weight), while logistic regressions are used to predict binary or categorical variables (e.g., indicator variable for dietary supplement use). The per protocol causal contrast of hypothetical intervention presented in Table 2 is then emulated based on Monte Carlo simulated data generated using the g formula algorithm [44]. The parametric g formula correctly accounts for time-varying confounding in the presence of feedback between the intervention and the confounding variables, since confounding is addressed using standardization [41,42]. Furthermore, standardization allows to estimate an average causal effect (i.e., marginal effect) consistent with the estimand of interest (Equation 1) rather than a conditional effect. In summary, a “threshold interventions” that depend on the reported dietary intakes or amount of physical activity [43,45] and the parametric g-formula [44,46] will be used to emulate the intervention of “consuming at least \\(x\\) servings of food” and “doing at least \\(x\\) minutes of light to vigorous physical activity”.\nFigure 2 presents the causal DAG of the hypothesized relationship between a sustained lifestyle intervention strategy (\\(X_0, X_1\\)) and an end of follow-up outcome \\(Y\\), for one follow-up after baseline (year 1). The model is limited to year 1 for clarity but the hypothesized causal structure extends to additional follow-ups. The exposure of interest \\(X_k\\) is the joint and cumulative effect of a sustained diet and physical activity intervention strategy measured at baseline and at follow-ups.\nIn the context of this target trial emulation (Figure 2), \\(P\\) includes dietary habits prior to the baseline assessment. \\(P\\) can have an effect on baseline dietary habits (e.g., prior healthy habits increase likelihood of baseline healthy habits) and dietary habits throughout the target trial emulation (e.g., prior healthy habits increase likelihood of adhering to healthy habits). \\(P\\) also influences baseline and time-varying confounding. Finally, given the long-term effect of chronic exposure, \\(P\\) potentially also affect \\(Y\\) directly.\n\n\nCode\n# ********************************************** #\n#           Input Dagitty information            #\n# ********************************************** #\n\n# note: time-varying DAG with one follow-up\n\n# Daggitty frame\ndag_one_t &lt;-\n dagitty::dagitty('dag {\nbb=\"0,0,1,1\"\n\"Z\" [pos=\"0.10,0.4\"]\n\"P-1\" [pos=\"0.10,0.300\",Xdjusted=\"1\"]\nL0 [pos=\"0.200,0.500\",Xdjusted=\"1\"]\nL1 [pos=\"0.400,0.500\",Xdjusted=\"1\"]\nX0 [exposure,pos=\"0.300,0.300\"]\nX1 [exposure,pos=\"0.500,0.300\"]\nY [outcome,pos=\"0.700,0.300\"]\n\"P-1\" -&gt; L0\n\"P-1\" -&gt; L1\n\"P-1\" -&gt; X0\n\"P-1\" -&gt; X1 [pos=\"0.240,0.400\"]\n\"P-1\" -&gt; Y [pos=\"0.260,0.500\"]\nL0 -&gt; L1\nL0 -&gt; X0\nL0 -&gt; X1\nL0 -&gt; Y\nL1 -&gt; X1\nL1 -&gt; Y\nX0 -&gt; L1\nX0 -&gt; X1\nX1 -&gt; Y\n}')\n\n# Transform to ggdag\ndag_one_t &lt;- ggdag::tidy_dagitty(dag_one_t)\n\n# Generate second set of coordinates for edge-arc \ndag_one_t &lt;- \n  dag_one_t |&gt;\n    mutate(\n    ## create second set of coordinates for edge-arc\n    # x coordinates\n    xend_arc = case_when(\n     name==\"P-1\" & to ==\"X1\" ~ xend,\n     name==\"P-1\" & to ==\"Y\" ~ xend ,\n     .default = NA \n    ),\n    # y coordinates\n    yend_arc = case_when(\n      name==\"P-1\" & to ==\"X1\" ~ yend,\n      name==\"P-1\" & to ==\"Y\" ~ yend ,\n      .default = NA \n    ),\n    # remove straight edge for those flag with arc\n    xend = ifelse(is.na(xend_arc),xend,NA),\n    yend = ifelse(is.na(yend_arc),yend,NA),\n    ## z coordinates\n    xend = ifelse(name==\"Z\",x+0.1,xend),\n    yend = ifelse(name==\"Z\",y+0.1,yend)\n    )\n\n# add nodes label for ggplot\ndag_one_t_labels &lt;-\n  data.frame(dag_one_t) |&gt;\n  dplyr::mutate(\n    label = case_when(\n    name ==\"X0\"~\"X\\u2080\",\n    name ==\"X1\"~ \"X\\u2081\",\n    name ==\"L0\" ~ \"L\\u2080\",\n    name ==\"L1\" ~ \"L\\u2081\",\n    name ==\"Y\"  ~ \"Y\",\n    name ==\"P-1\" ~ \"P\",\n    name == \"Z\" ~ \"Z\")\n  ) |&gt;\n  dplyr::pull(label)\n\n# ********************************************** #\n#             Create DAG with ggplot             #\n# ********************************************** #\n\nmake_dag_one_t &lt;- function(scale_node_size=1, text_size=4, default_node_size=16){\n  \n  node_size &lt;- default_node_size * scale_node_size\n\nfig_dag_one_t &lt;-\n  dag_one_t  |&gt;\n  ggplot(aes(\n    x = x,\n    y = y,\n    xend = xend,\n    yend = yend\n  )) +\n  geom_dag_point(size = node_size) +\n  geom_dag_edges() +\n  geom_dag_edges_arc(aes(xend=xend_arc,yend=yend_arc), curvature=0.25) +\n  geom_dag_text(aes(label=dag_one_t_labels), size=text_size) +\n  theme_dag() + \n  theme(\n    plot.background = element_rect(colour=\"white\")\n  ) \n\nreturn(fig_dag_one_t)\n}\n\n# Generate figure for different layout\n\n## normal version\nfig_dag_one_t_normal &lt;- \n  make_dag_one_t(text_size=7)\n\n## JMIR format\nfig_dag_one_t_jmir &lt;- \n  make_dag_one_t(scale_node_size=0.5, text_size=3.5) + \n  theme(plot.caption=element_text(size=6))\n\n\n# ********************************************** #\n#                Save as png/pdf                 #\n# ********************************************** #\n\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_1t.pdf\"),\n                plot=fig_dag_one_t_normal, dpi=300, width=8,height=4.5, units=\"in\",scale=0.85,device = cairo_pdf)\n\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_1t.png\"),\n                plot=fig_dag_one_t_normal, dpi=300, width=8,height=4.5, units=\"in\",scale=0.85)\n\nggplot2::ggsave(file.path(dir_fig,\"fig_dag_1t_jmir.png\"),\n                plot=fig_dag_one_t_jmir, dpi=300, width=1200,height=800, units=\"px\",scale=1)\n\n# ********************************************** #\n#              Load rendered figure              #\n# ********************************************** #\n  \n  knitr::include_graphics(file.path(dir_fig,\"fig_dag_1t.png\"))\n\n\n\n\n\n\n\n\nFigure 2: Directed acyclic graph (DAG) depicting the hypothesized relationship among previous dietary exposure, time-varying interventions (diet and physical activity), and covariates. Arrows from the Z node are not shown for clarity but would point toward all baseline and time-varying nodes, as well as the outcome. Only 1 follow-up is shown for visualization purposes, but the hypothesized causal structure extends to additional follow-ups. Subscripts indicate the time points, where 0 represents baseline and 1 represents time point 1.\n\n\n\n\n\nThe intention-to-treat analysis is similar to the per protocol analysis. However, only baseline diet and physical activity habits and covariates are considered as well as pre-baseline diet and physical activity. In both the per protocol and intention-to-treat analyses, loss to follow-up (e.g., non-response or missing follow-up, health outcomes not measured) will be accounted for using g-methods such as inverse probability weighting.\n\nDietary Assessment\nIn the NuAge study, diet during the year before baseline was assessed using one semi-quantitative food-frequency questionnaire [47]. Dietary intakes at baseline (time 0) and each annual follow-ups (time 1, 2 and 3) were assessed using 3 repeated face-to-face interviewer-administered 24-hour dietary recall.\nDietary intakes measured using 24-h dietary recall are more accurate (i.e., less systematic error or bias) than food-frequency questionnaire [48–50] but are particularly affected by random measurement error (i.e., within-individual random error) [50]. When several variables measured with errors are considered simultaneously in a regression model, the regression coefficients may be biased in any direction [51]. To account for random measurement error, the National Cancer Institute Markov Chain Monte Carlo (MCMC) multivariate method could be applied [52]. However, the combination of the parametric g-formula and multivariate measurement error correction using the NCI MCMC method is not feasible. The NCI MCMC method estimates time-invariant measurement error-corrected intakes, while the g formula algorithm is designed for time-varying exposures.\nRecognizing the importance of accounting for measurement error, the correction for measurement error will be reserved for the secondary intention-to-treat analysis. For the intention-to-treat contrast, the time-varying values of exposure and the time-varying values of confounding are not considered. Thus, the NCI MCMC method will be used to obtain measurement error-corrected estimates of the relationship between dietary intakes measured at baseline and outcome at the end of follow-up. Of note, the three 24-h dietary recalls collected at each time point contribute to reducing random errors, at least to some extent, even in absence of measurement error correction.\n\nSensitivity analysis to assess the impact of measurement error\nFor the secondary intention-to-treat analysis, results based on the measurement error-corrected and uncorrected dietary intakes will be compared. The difference between the estimated relationships will allow to extrapolate the impact of not accounting for random errors in the primary per protocol analysis.\n\n\n\nPhysical activity assessment\nPhysical activity throughout the study was assessed using the Physical Activity Scale for the Elderly (PASE) questionnaire [53,54]. Rather than the total PASE score, specific questions estimating the total time of physical activities will be used to be consistent with the intervention strategy.\n\n\nCovariates and subgroups\nTo the extent permitted by the number of observations for each outcome, continuous covariates will be modelled using restricted cubic splines with 3 to 5 knots (at percentiles 10-50-90, 5-35-65-95 or 5-27.5-50-77.5-95) [55]. Categorical covariates will be modelled to ensure a sufficient sample size in each level.\nThe effect of dietary changes will be estimated for the full sample. The sample will also be stratified by (biological) sex to reflect both potential biological differences and, to some extent, gender differences (although not reported).\n\n\nVariance estimation\nVariance will be estimated using a minimum of 200 bootstrap sample replicates to consider uncertainty at each step of the estimation [56].\n\n\nSoftware and code\nThe main statistical analyses will be conducted using R (version 4.3.1 or greater) and the gfoRmula package [44,57]. The manuscript results will be generated using Quarto markdown. Codes for main analyses and generation of manuscript results will be shared in a publicly available code repository."
  },
  {
    "objectID": "9.1-Manuscript.html#ethical-considerations",
    "href": "9.1-Manuscript.html#ethical-considerations",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Ethical Considerations",
    "text": "Ethical Considerations\n\nHuman subject ethics review approvals or exemptions\nThe original NuAge study protocol was approved by the Research Ethics Boards of the Institut universitaire de gériatrie de Montréal and the Institut universitaire de gériatrie de Sherbrooke (Quebec, Canada). The NuAge Database and Biobank [58] has received approval by the Research Ethics Board of the Centre intégré universitaire de santé et de services sociaux de l’Estrie—Centre hospitalier universitaire de Sherbrooke. Secondary analyses of data from the NuAge Database and Biobank for the study described in this protocol are approved by the McGill University Research Ethics Board Office (#22-11-041).\n\n\nInformed Consent\nAll participants of the NuAge study provided informed consent. From the initial cohort of 1,793 participants, 1,753 (98%) agreed to the integration of their data and biological samples into the NuAge Database and Biobank for future studies.\n\n\nPrivacy and confidentiality\nSecondary analyses based on the NuAge Database and Biobank use de-identified data, which do not allow participants to be identified by the investigators.\n\n\nCompensation details\nParticipants from the NuAge study voluntarily consented to participate and were not provided with monetary compensation."
  },
  {
    "objectID": "9.1-Manuscript.html#limitations",
    "href": "9.1-Manuscript.html#limitations",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Limitations",
    "text": "Limitations\nStrengths of this study and protocol include the explicit emulation of a hypothetical trial, the thorough description of the emulation of the sustained dietary intervention, and the use of background knowledge and DAG to derive a sufficient set of confounders. Limitations must be addressed. First, the sample size of the NuAge study is relatively limited (n=1753), although comprehensive nutrition and covariate data was collected. Second, the target food intakes based on diet simulations from Health Canada exceed the 99th percentile of the usual intake distribution of Canadians 65 years or older from Canada in 2015 [3]. The a posteriori revision of the dietary intervention targets will be needed if observed dietary intakes in NuAge are too far from targets (Table 2), as was done in a previous nutrition target trial emulation [22]. Third, the presence of random measurement error associated with 24-h dietary recalls may bias estimates. Finally, the target trial emulation cannot replace an actual RCT. Evidence from RCT will be required to confirm the value of either CFG recommendations or the enhanced CFG recommendations."
  },
  {
    "objectID": "9.1-Manuscript.html#conclusion",
    "href": "9.1-Manuscript.html#conclusion",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Conclusion",
    "text": "Conclusion\nIn conclusion, the target trial framework is relevant to estimate the causal effect of adhering to CFG’s recommendations using non-experimental data when a RCT is impractical [11,19]. Coupled with key assumptions, including the absence of unmeasured confounding, the absence of measurement error and no model misspecification, we believe the emulation will provide timely evidence regarding the effect of adhering to CFG’s recommendations in older adults and inform on the added value of a reformulation."
  },
  {
    "objectID": "9.1-Manuscript.html#authors-contributions",
    "href": "9.1-Manuscript.html#authors-contributions",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Authors’ contributions",
    "text": "Authors’ contributions\nConceptualization: all authors; Methodology: DB and SC; Data curation, formal analysis, visualization and writing – original draft: DB; Supervision: SC; Writing – review & editing: all authors."
  },
  {
    "objectID": "9.1-Manuscript.html#conflicts-of-interest",
    "href": "9.1-Manuscript.html#conflicts-of-interest",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Conflicts of Interest",
    "text": "Conflicts of Interest\nDB was a casual employee of Health Canada (2019-2020) and held a doctoral training award from the Fonds de recherche du Québec – Santé (2019-2021). DB has no conflicts of interest. SC receives research funding from the CIHR, Fonds de recherche du Québec, Canadian Foundation for Dietetics Research, Canadian Foundation for Innovation and Canadian Cancer Society. None of these agencies has funded nor was involved in this work.\nNP is the NuAge Database Administrator; NP and SC serve as NuAge Steering Committee Members.\nThe NuAge Study was supported by a research grant from the Canadian Institutes of Health Research (CIHR; MOP-62842). The NuAge Database and Biobank are supported by the Fonds de recherche du Québec (FRQ; 2020-VICO-279753), the Quebec Network for Research on Aging, a thematic network funded by the Fonds de Recherche du Québec - Santé (FRQS) and by the Merck-Frosst Chair funded by La Fondation de l’Université de Sherbrooke."
  },
  {
    "objectID": "9.1-Manuscript.html#funding-statement",
    "href": "9.1-Manuscript.html#funding-statement",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Funding statement",
    "text": "Funding statement\nThis work was supported by a Canadian Institutes of Health Research (CIHR) Fellowship award (MFE-181852) to DB."
  },
  {
    "objectID": "9.1-Manuscript.html#data-availability-and-code",
    "href": "9.1-Manuscript.html#data-availability-and-code",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Data availability and code",
    "text": "Data availability and code\nThe data and code used for this manuscript will be made available at https://github.com/didierbrassard/NuAge_protocol\nMultimedia Appendix 1: Supplemental Table 1. HEFI-2019 dietary constituents and score among simulated diets by Health Canada, by age and sex group"
  },
  {
    "objectID": "9.2-Supplement.html",
    "href": "9.2-Supplement.html",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "",
    "text": "Code\nprint_table &lt;- \"Y\"\n\n# ********************************************** #\n#                 Quarto set-up                  #\n# ********************************************** #\n\nknitr::opts_chunk$set(dpi = 300,\n                      out.width = \"80%\",\n                      fig.env = \"figure\",\n                      fig.align = \"center\"\n                      )\n\n## suppress scientific notation\noptions(scipen = 9999)\n\n# *********************************************** #\n#                   Packages                      #\n# *********************************************** #\n\n## data\nlibrary(dplyr)\nlibrary(tidylog)\nlibrary(readxl)\n\n## analysis\nlibrary(hefi2019)\n\n## results presentation\nlibrary(ggplot2)\nlibrary(patchwork)\nlibrary(gt)\nlibrary(tinytex)\nlibrary(MetBrewer)\nlibrary(dagitty)\nlibrary(ggdag)\n\n# ********************************************** #\n#               Location of files                #\n# ********************************************** #\n\ndir_scripts &lt;- here::here(\"scripts\")\ndir_processed &lt;- here::here(\"data\", \"processed\")\ndir_results &lt;- here::here(\"data\", \"results\")\ndir_tab &lt;- here::here(\"manuscript\", \"tables\")\n  if(dir.exists(dir_tab)==FALSE){\n    dir.create(dir_tab, recursive = TRUE)\n  }\ndir_fig &lt;- here::here(\"manuscript\", \"figures\")\n  if(dir.exists(dir_fig)==FALSE){\n    dir.create(dir_fig, recursive = TRUE)\n  }\ndir_supp &lt;- here::here(\"manuscript\", \"supplementary\")\n  if(dir.exists(dir_supp)==FALSE){\n    dir.create(dir_supp, recursive = TRUE)\n  }\n\n# ********************************************** #\n#            Load functions and data             #\n# ********************************************** #\n\n## GT Table style\n  gtstyle &lt;- function(gtobject,footnote_marker=\"numbers\"){\n    gtobject |&gt;\n      gt::tab_style(\n        style = list(\n          cell_text(weight = \"bold\")  ),\n        locations = cells_row_groups(groups = everything())\n      ) |&gt;\n      gt::opt_align_table_header(\"left\") |&gt;\n      gt::opt_footnote_marks(marks=footnote_marker)\n  }"
  },
  {
    "objectID": "9.2-Supplement.html#simulated-diets-from-health-canada",
    "href": "9.2-Supplement.html#simulated-diets-from-health-canada",
    "title": "Estimating the Effect of Adhering to the Recommendations of the 2019 Canada’s Food Guide on Health Outcomes in Older Adults: Protocol for a Target Trial Emulation",
    "section": "Simulated diets from Health Canada",
    "text": "Simulated diets from Health Canada\n\n\nCode\n# #| label: tbl-dietsim\n# #| tbl-cap: \"\"\n\n# ********************************************** #\n#             Output sim. diet data              #\n# ********************************************** #\n\n# note: See code &lt;1.0-Data_preparation.R&gt; for details\n\nload(file.path(dir_processed, \"dietsim_hefi.rdata\"))\n\n# revise DRI group formatting\ndietsim_hefi$drig_f &lt;- \n  factor(dietsim_hefi$drig,\n         levels=c(0,12,13,14,15),\n         labels = c(\"All, 51y+\",\n                    \"Males, 51-70 y\",\n                    \"Females, 51-70 y\",\n                    \"Males 71y+\",\n                    \"Females 71y+\"))\n\n# ********************************************** #\n#          Output vectors of CFG foods           #\n# ********************************************** #\n\nrecommended &lt;- c(\n  \"vegetables and fruits\",\n  \"whole-grain foods\",\n  \"protein foods\",\n  \"unsweetened milk and plant-based beverages with protein\"\n)\n\nnotrecommended &lt;- c(\n  \"non-whole grain foods\",\n  #\"other foods not recommended\",\n  \"other low nutritive value foods\",\n  #\"other beverages not recommended\",\n  \"juice, sugary drinks and alcohol\",\n  \"fatty foods rich in saturated fats\")\n\n# ********************************************** #\n#          Generate table of sim. diet           #\n# ********************************************** #\n\ntab_dietsim &lt;- \n  dietsim_hefi |&gt;\n  mutate(\n  #combine FAM+FAP\n    FAM_n_FAP = fam+fap,\n  # rescale as RA\n    milk_plantbev = milk_plantbev/258) |&gt;\n  select(-c(drig,starts_with(\"HEFI2019C\"),starts_with(\"RATIO\"),\n            milk,plantbev,SFA_PERC,SUG_PERC,SODDEN,pro)) |&gt;\n  gt::gt() |&gt;\n  gt::cols_move_to_start(drig_f) |&gt;\n  gt::tab_spanner(label=\"Foods, Reference Amounts (RA)\",\n                  columns = c(vf,wg,pfpb,pfab, milk_plantbev, ufa)) |&gt;\n  gt::tab_spanner(label=\"Total nutrients\",\n                  columns = c(ekc,fsug, fas, FAM_n_FAP, sod)) |&gt;\n  gt::fmt_number(columns = c(vf, wg, pfpb, pfab, milk_plantbev, ufa, fsug, fas, fam, fap, FAM_n_FAP, HEFI2019_TOTAL_SCORE),decimals = 1) |&gt;\n  gt::fmt_number(columns = c(ekc, sod), decimals = 0) |&gt;\n  gt::cols_hide(columns=c(totfoodsRA, fam, fap)) |&gt;\n  gt::cols_label(\n    drig_f = \"Age/sex group\",\n    vf     = \"Vegetables & fruits\",\n    wg     = \"Whole grains\",\n    pfpb   = \"Protein foods, plant-based\",\n    pfab   = \"Protein foods, animal-based\",\n    milk_plantbev = \"Milk & Plant-based bev. with protein\",\n    ufa    = \"Unsaturated oils & fats\",\n    ekc    = \"Energy, kcal\",\n    fsug   = \"Free sugars, g\",\n    fas    = \"SFA, g\",\n    FAM_n_FAP = \"Unsaturated fats, g\",\n    #FAM    = \"MUFA, g\",FAP    = \"PUFA, g\",\n    sod    = \"Sodium, mg\",\n    HEFI2019_TOTAL_SCORE = \"HEFI-2019 score (/80), points\" ) |&gt;\n  gt::tab_header(title=\"Supplemental Table 1. HEFI-2019 dietary constituents and score among simulated diets by Health Canada, by age and sex group\") |&gt;\n  gt::tab_footnote(footnote = \"Data adapted from Health Canada. Simulated composite diets. https://open.canada.ca/data/en/dataset/0490749d-b0b0-410a-9577-a903c6cec2be: Open Government Portal, 2022. CFG-2019, Canada's Food Guide; DRI, Dietary Reference Intake; HEFI-2019, Healthy Eating Food Index 2019; RA, reference amounts; SFA, saturated fats.\", locations = cells_title(\"title\")) |&gt;\n  gt::tab_footnote(footnote = glue::glue(\"The HEFI-2019 total score has a maximum of 80 points. Foods not recommended (i.e., {knitr::combine_words(notrecommended)}) were all assigned 0 consumption.\"),\n                   locations = cells_column_labels(columns=\"HEFI2019_TOTAL_SCORE\") )\n\n# ********************************************** #\n#                  Print table                   #\n# ********************************************** #\n\nif(print_table==\"Y\") {\n  tab_dietsim |&gt; gtstyle()\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSupplemental Table 1. HEFI-2019 dietary constituents and score among simulated diets by Health Canada, by age and sex group1\n\n\nAge/sex group\n\nFoods, Reference Amounts (RA)\n\n\nTotal nutrients\n\nHEFI-2019 score (/80), points2\n\n\nVegetables & fruits\nWhole grains\nProtein foods, plant-based\nProtein foods, animal-based\nMilk & Plant-based bev. with protein\nUnsaturated oils & fats\nEnergy, kcal\nFree sugars, g\nSFA, g\nUnsaturated fats, g\nSodium, mg\n\n\n\n\nAll, 51y+\n9.0\n3.9\n2.0\n1.9\n1.0\n1.0\n1,865\n6.4\n10.2\n41.6\n1,066\n78.5\n\n\nMales, 51-70 y\n9.9\n5.0\n2.4\n2.3\n1.0\n1.0\n2,259\n7.1\n11.7\n45.2\n1,174\n78.3\n\n\nFemales, 51-70 y\n8.6\n3.5\n2.0\n1.9\n1.0\n1.0\n1,737\n5.5\n9.7\n41.3\n993\n78.3\n\n\nMales 71y+\n9.9\n4.2\n2.0\n1.8\n1.0\n1.0\n1,959\n7.0\n10.6\n43.0\n1,142\n78.6\n\n\nFemales 71y+\n7.7\n3.0\n1.7\n1.6\n1.0\n1.0\n1,507\n5.9\n8.7\n36.8\n954\n78.0\n\n\n\n1 Data adapted from Health Canada. Simulated composite diets. https://open.canada.ca/data/en/dataset/0490749d-b0b0-410a-9577-a903c6cec2be: Open Government Portal, 2022. CFG-2019, Canada's Food Guide; DRI, Dietary Reference Intake; HEFI-2019, Healthy Eating Food Index 2019; RA, reference amounts; SFA, saturated fats.\n\n\n2 The HEFI-2019 total score has a maximum of 80 points. Foods not recommended (i.e., non-whole grain foods, other low nutritive value foods, juice, sugary drinks and alcohol, and fatty foods rich in saturated fats) were all assigned 0 consumption.\n\n\n\n\n\n\n\n\nCode\n# ********************************************** #\n#                   Save table                   #\n# ********************************************** #\n\ngt::gtsave(tab_dietsim,\n           filename = file.path(dir_supp,\"tab_dietsim.docx\"))"
  }
]